<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>✍Today Youngjun learned</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/til/images/logo.png">
    <link rel="manifest" href="/til/manifest.json">
    <meta name="description" content="Youngjun`s Personal Wiki (Today I Learned)">
    <link rel="preload" href="/til/assets/css/0.styles.bf2a48be.css" as="style"><link rel="preload" href="/til/assets/js/app.a6d1129f.js" as="script"><link rel="preload" href="/til/assets/js/2.fec30695.js" as="script"><link rel="preload" href="/til/assets/js/54.1e20a64e.js" as="script"><link rel="preload" href="/til/assets/js/4.3d9948a0.js" as="script"><link rel="prefetch" href="/til/assets/js/10.ffc6b912.js"><link rel="prefetch" href="/til/assets/js/11.d2215499.js"><link rel="prefetch" href="/til/assets/js/12.2170719b.js"><link rel="prefetch" href="/til/assets/js/13.6f10b584.js"><link rel="prefetch" href="/til/assets/js/14.f245583f.js"><link rel="prefetch" href="/til/assets/js/15.df1a653e.js"><link rel="prefetch" href="/til/assets/js/16.f89f7b52.js"><link rel="prefetch" href="/til/assets/js/17.c2bfc43a.js"><link rel="prefetch" href="/til/assets/js/18.d165fb47.js"><link rel="prefetch" href="/til/assets/js/19.101576be.js"><link rel="prefetch" href="/til/assets/js/20.874f949a.js"><link rel="prefetch" href="/til/assets/js/21.088a52f4.js"><link rel="prefetch" href="/til/assets/js/22.fddb1432.js"><link rel="prefetch" href="/til/assets/js/23.8a88d94d.js"><link rel="prefetch" href="/til/assets/js/24.eef59ee1.js"><link rel="prefetch" href="/til/assets/js/25.54d32b35.js"><link rel="prefetch" href="/til/assets/js/26.d5bf5c10.js"><link rel="prefetch" href="/til/assets/js/27.58078fb5.js"><link rel="prefetch" href="/til/assets/js/28.561dc1b9.js"><link rel="prefetch" href="/til/assets/js/29.a2eb53a2.js"><link rel="prefetch" href="/til/assets/js/3.3072a084.js"><link rel="prefetch" href="/til/assets/js/30.a5a9b2fd.js"><link rel="prefetch" href="/til/assets/js/31.2812e71a.js"><link rel="prefetch" href="/til/assets/js/32.b6d6c255.js"><link rel="prefetch" href="/til/assets/js/33.b8cd8ddf.js"><link rel="prefetch" href="/til/assets/js/34.0bbbe63c.js"><link rel="prefetch" href="/til/assets/js/35.44528f62.js"><link rel="prefetch" href="/til/assets/js/36.06b379e6.js"><link rel="prefetch" href="/til/assets/js/37.6ff0d52e.js"><link rel="prefetch" href="/til/assets/js/38.36520ad8.js"><link rel="prefetch" href="/til/assets/js/39.9f942e48.js"><link rel="prefetch" href="/til/assets/js/40.5b10f3d4.js"><link rel="prefetch" href="/til/assets/js/41.3f1d7973.js"><link rel="prefetch" href="/til/assets/js/42.b4309241.js"><link rel="prefetch" href="/til/assets/js/43.da7ff5e5.js"><link rel="prefetch" href="/til/assets/js/44.e489c876.js"><link rel="prefetch" href="/til/assets/js/45.c62b3816.js"><link rel="prefetch" href="/til/assets/js/46.29083187.js"><link rel="prefetch" href="/til/assets/js/47.a0801bb4.js"><link rel="prefetch" href="/til/assets/js/48.a76415ff.js"><link rel="prefetch" href="/til/assets/js/49.b68703c4.js"><link rel="prefetch" href="/til/assets/js/5.819b6666.js"><link rel="prefetch" href="/til/assets/js/50.30c2e85b.js"><link rel="prefetch" href="/til/assets/js/51.b24d5435.js"><link rel="prefetch" href="/til/assets/js/52.9be477b8.js"><link rel="prefetch" href="/til/assets/js/53.0f869fbd.js"><link rel="prefetch" href="/til/assets/js/55.78d0057d.js"><link rel="prefetch" href="/til/assets/js/56.87c28e7f.js"><link rel="prefetch" href="/til/assets/js/57.77eb9be4.js"><link rel="prefetch" href="/til/assets/js/58.c59b523a.js"><link rel="prefetch" href="/til/assets/js/59.66c4e240.js"><link rel="prefetch" href="/til/assets/js/6.2d326fcc.js"><link rel="prefetch" href="/til/assets/js/60.6e9dfeef.js"><link rel="prefetch" href="/til/assets/js/61.7b01fb1d.js"><link rel="prefetch" href="/til/assets/js/62.621305b5.js"><link rel="prefetch" href="/til/assets/js/63.69f5c391.js"><link rel="prefetch" href="/til/assets/js/64.31bebc24.js"><link rel="prefetch" href="/til/assets/js/65.a292606a.js"><link rel="prefetch" href="/til/assets/js/66.c34c3c03.js"><link rel="prefetch" href="/til/assets/js/67.da83d763.js"><link rel="prefetch" href="/til/assets/js/68.941c9c67.js"><link rel="prefetch" href="/til/assets/js/69.c5de9eb3.js"><link rel="prefetch" href="/til/assets/js/7.87cdee2d.js"><link rel="prefetch" href="/til/assets/js/70.a2e63e22.js"><link rel="prefetch" href="/til/assets/js/71.8c1711e0.js"><link rel="prefetch" href="/til/assets/js/72.afbb1084.js"><link rel="prefetch" href="/til/assets/js/73.6e9131eb.js"><link rel="prefetch" href="/til/assets/js/74.8a845bbf.js"><link rel="prefetch" href="/til/assets/js/75.95c89610.js"><link rel="prefetch" href="/til/assets/js/76.75ebc89c.js"><link rel="prefetch" href="/til/assets/js/77.9acb15b3.js"><link rel="prefetch" href="/til/assets/js/78.7e6b32af.js"><link rel="prefetch" href="/til/assets/js/8.60ed514c.js"><link rel="prefetch" href="/til/assets/js/9.23da3e8e.js">
    <link rel="stylesheet" href="/til/assets/css/0.styles.bf2a48be.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/til/" class="home-link router-link-active"><!----> <span class="site-name">✍Today Youngjun learned</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/jun108059/til" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://dev-youngjun.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/jun108059/til" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://dev-youngjun.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>내 PC에서 실습하기 - 1</p> <p>윈도우나 맥이 설치되어 있는 Desktop가 1대 있고, 그위에 VirtualBox와 같은 도구를 이용해서 VM을 만드는 경우</p> <p>1-1) Install Virtualbox</p> <p>1-1-1) Virtualbox 다운로드 및 설치
[윈도우10 버전으로 진행] 아래 경로에서 [Windows hosts] 클릭 하여 다운로드 후 설치 (별다른 변경 없이 Next만 함)</p> <blockquote></blockquote> <p>https://www.virtualbox.org/wiki/Downloads</p> <p>Mac 사용자 참고 URL</p> <blockquote><p>https://www.virtualbox.org/wiki/Mac%20OS%20X%20build%20instructions</p></blockquote> <p>1-1-2) CentOS Download
아래 경로로 들어가서 원하는 경로에서 파일 다운로드</p> <blockquote><p>http://isoredirect.centos.org/centos/7/isos/x86_64/</p></blockquote> <p>1-1-3) 원격접속 툴 MobaXterm 설치
꼭 MobaXterm이 아닌 각자 편한 원격접속 툴을 사용하면 됨.
아래 예제는 MobaXterm를 설치하고 필요한 Host 등록 예제</p> <blockquote><p>https://mobaxterm.mobatek.net/</p></blockquote> <ul><li>[GET MOBAXTERM NOW] 버튼 클릭</li> <li>Free 버전 [Download now]</li> <li>Installer editon 다운로드 및 실행</li> <li>Sessions &gt; SSH &gt; Remote host : 192.168.0.30 &gt; [Bookmark settings] Session name : master-192.168.0.30 &gt; [ok]</li> <li>Sessions &gt; SSH &gt; Remote host : 192.168.0.31 &gt; [Bookmark settings] Session name : node1-192.168.0.31 &gt; [ok]</li> <li>Sessions &gt; SSH &gt; Remote host : 192.168.0.32 &gt; [Bookmark settings] Session name : node2-192.168.0.32 &gt; [ok]</li></ul> <p>2-1) Setting VM</p> <p>2-1-1) VM 스펙 설정
메모리 및 디스크는 각자 상황에 맞게 참고해서 VM 설정</p> <ol><li>[VM 생성 1단계] 머신 &gt; 새로 만들기 클릭</li> <li>[VM 생성 1단계] 이름 : k8s-master, 종류: Linux, 버전: Other Linux(32-bit)</li> <li>[VM 생성 2단계] 메모리 : 4096 MB</li> <li>[VM 생성 3단계] 하드디스크 : 지금 새 가상 하드 디스크 만들기 (VDI:VirtualBox 디크스 이미지, 동적할당, 150GB)</li> <li>[VM 생성 후 시스템 설정] 프로세서 개수 : CPU 2개</li> <li>[VM 생성 후 저장소 설정] 컨트롤러:IDE 하위에 있는 광학드라이브 클릭 &gt; CentOS 이미지 선택 후 확인</li> <li>[VM 생성 후 네트워크 설정] VM 선택 후 설정 버튼 클릭 &gt; 네트워크 &gt; 어댑터 1 탭 &gt; 다음에 연결됨 [어댑터에 브리지] 선택</li> <li>시작</li></ol> <p>2-2) Install CentOS</p> <p>2-2-1) CentOS 설치
4번 단계에서 
8.8.8.8
는 Google DNS입니다. 원하는 DNS 쓰면 됨</p> <ol><li>Test this media &amp; install CentOS 7</li> <li>Language : 한국어</li> <li>Disk 설정 [시스템 &gt; 설치 대상]
<ul><li>[기타 저장소 옵션 &gt; 파티션 설정] 파티션을 설정합니다. [체크] 후 [완료]</li> <li>새로운 CentOS 설치 &gt; 여기를 클릭하여 자동으로 생성합니다. [클릭]</li> <li>/home [클릭] 후 용량 5.12 GiB로 변경 [설정 업데이트 클릭]</li> <li>/ [클릭] 후 140 GiB 변경 후 [설정 업데이트 클릭]</li> <li>[완료], [변경 사항 적용]</li></ul></li> <li>네트워크 설정 [시스템 &gt; 네트워크 및 호스트명 설정]
<ul><li>호스트 이름: k8s-master [적용]</li> <li>이더넷 [켬], [설정], [IPv4 설정] 탭</li> <li>방식: 수동으로 선택,</li> <li>[Add] -&gt; 주소: 192.168.0.30, 넷마스크 : 255.255.255.0, 게이트웨이: 192.168.0.1, DNS 서버 : 8.8.8.8 [저장][완료]</li></ul></li> <li>설치시작</li> <li>[설정 &gt; 사용자 설정] ROOT 암호 설정</li> <li>설치 완료 후 [재부팅]</li></ol> <p>내 PC에서 실습하기 - 2</p> <p>3-1) Pre-Setting</p> <p>3-1-1) SELinux 설정</p> <p>Ubuntu나 Debian등 다른 OS를 설치하면 참고</p> <p>https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</p> <p>https://kubernetes.io/docs/setup/production-environment/container-runtimes/#docker</p> <p>쿠버네티스가 Pod Network에 필요한 호스트 파일 시스템에 액세스가 가능하도록 하기 위해서 필요한 설정</p> <p>아래 설정으로 SELinux을 permissive로 변경</p> <p>setenforce 0</p> <p>리부팅시 다시 원복되기 때문에 아래 명령을 통해서 영구적으로 변경</p> <p>sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config</p> <p>아래 명령어를 실행해서 Current mode:permissive 내용 확인</p> <p>sestatus</p> <p>3-1-2) 방화벽 해제</p> <p>firewalld 비활성화</p> <p>systemctl stop firewalld &amp;&amp; systemctl disable firewalld</p> <p>NetworkManager 비활성화</p> <p>systemctl stop NetworkManager &amp;&amp; systemctl disable</p> <p>NetworkManager</p> <p>3-1-3) Swap 비활성화</p> <p>Swap 사용에 관련한 내용</p> <blockquote><p>https://github.com/kubernetes/kubernetes/issues/53533</p></blockquote> <p>참고해서 설정</p> <p>swapoff -a &amp;&amp; sed -i '/ swap / s/^/#/' /etc/fstab</p> <p>3-1-4) Iptables 커널 옵션 활성화</p> <p>RHEL이나 CentOS7 사용 시 iptables가 무시돼서 트래픽이 잘못 라우팅되는 문제가 발생한다고 하여 아래 설정이 추가</p> <p>cat &lt;<EOF>  /etc/sysctl.d/k8s.conf</EOF></p> <p>net.bridge.bridge-nf-call-ip6tables = 1</p> <p>net.bridge.bridge-nf-call-iptables = 1</p> <p>EOF</p> <p>sysctl --system</p> <p>3-1-5) 쿠버네티스 YUM Repository 설정</p> <p>YUM에 대한 자세한 내용</p> <blockquote><p>https://www.lesstif.com/display/1STB/yum</p></blockquote> <p>cat &lt;<EOF> /etc/yum.repos.d/kubernetes.repo</EOF></p> <p>[kubernetes]</p> <p>name=Kubernetes</p> <p>baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64</p> <p>enabled=1</p> <p>gpgcheck=1</p> <p>repo_gpgcheck=1</p> <p>gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</p> <p>EOF</p> <p>3-1-6) Centos Update</p> <p>yum update</p> <p>3-1-7) Hosts 등록</p> <p>계획된 master와 node의 호스트 이름과 IP를 모두 등록하기</p> <p>안하면 kubeadm init시 Host이름으로 IP를 찾을 수 없다고 에러 발생</p> <p>cat &lt;&lt; EOF &gt;&gt; /etc/hosts</p> <p>192.168.0.30 k8s-master</p> <p>192.168.0.31 k8s-node1</p> <p>192.168.0.32 k8s-node2</p> <p>EOF</p> <p>3-2) Install</p> <p>3-2-1) Docker 설치</p> <p>도커 설치 전에 필요한 패키지 설치</p> <p>yum install -y yum-utils device-mapper-persistent-data lvm2</p> <p>도커 설치를 위한 저장소 를 설정</p> <p>yum-config-manager --add-repo</p> <p>https://download.docker.com/linux/centos/docker-ce.repo</p> <p>도커 패키지 설치</p> <p><code>yum update &amp;&amp; yum install docker-ce-18.06.2.ce</code></p> <p><code>mkdir /etc/docker</code></p> <p><code>cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;exec-opts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;native.cgroupdriver=systemd&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;log-driver&quot;</span><span class="token operator">:</span> <span class="token string">&quot;json-file&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;log-opts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;max-size&quot;</span><span class="token operator">:</span> <span class="token string">&quot;100m&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;storage-driver&quot;</span><span class="token operator">:</span> <span class="token string">&quot;overlay2&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;storage-opts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;overlay2.override_kernel_check=true&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>EOF</code></p> <p><code>mkdir -p /etc/systemd/system/docker.service.d</code></p> <p>3-2-2) Kubernetes 설치</p> <p><code>yum install -y --disableexcludes=kubernetes kubeadm-1.15.5-0.x86_64 kubectl-1.15.5-0.x86_64 kubelet-1.15.5-0.x86_64</code></p> <p>4-1) Clone VM</p> <p>4-1-1) 시스템 Shutdown</p> <p>여기까지 만든 이미지를 복사해 놓기 위해서 Master를 잠시 Shutdown</p> <p>shutdown now</p> <p>4-1-2) VM 복사</p> <p>VirtualBox UI를 통해 Master 선택 후 마우스 우클릭을 해서 [복제] 버튼 클릭</p> <ol><li><p>이름 : k8s-node1, MAC 주소정책 : 모든 네트워크 어댑터의 새 MAC 주소 생성</p></li> <li><p>복제방식 : 완전한 복제
node2도 반복</p></li></ol> <p>4-2) Config Node</p> <p>4-2-1) Network 변경하기</p> <p>VirtualBox UI에서 k8s-node1을 시작 시키면 뜨는 Console 창을 통해 아래 명령어 입력</p> <p>Host의 Ip Address를 변경하기 위해 아래 명령어로 설정을 열고</p> <p><code>vi /etc/sysconfig/network-scripts/ifcfg-eth0</code></p> <p>IPADDR=
부분을 해당 Node의 IP (192.168.0.31)로 변경</p> <div class="language- extra-class"><pre class="language-text"><code>DEVICE=
&quot;etho0&quot;
ONBOOT=&quot;yes&quot;
IPADDR=&quot;192.168.0.31&quot;
</code></pre></div><p>그리고 아래 명령어로 네트워크 재시작</p> <p><code>systemctl restart network</code></p> <p>4-2-2) Host Name 변경</p> <p>해당 Node의 Host 이름을 변경</p> <p><code>hostnamectl set-hostname k8s-node1</code></p> <p>이와 같은 방식으로 k8s-node2(192.168.0.32) 도 설정</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/16/2020, 7:32:16 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/til/assets/js/app.a6d1129f.js" defer></script><script src="/til/assets/js/2.fec30695.js" defer></script><script src="/til/assets/js/54.1e20a64e.js" defer></script><script src="/til/assets/js/4.3d9948a0.js" defer></script>
  </body>
</html>
