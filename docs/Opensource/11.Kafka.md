# ZooKeeper ì„¤ì •

---

ì‹¤ìŠµ í™˜ê²½

- ğŸ’¡ Java10 (Java 8ì´ìƒ í•„ìˆ˜)
- ğŸ’¡ Windows 10
- ğŸ’¡ Git Bash

---

ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ Kafkaë¥¼ ì„¤ì¹˜í•˜ê³  Zookeeperë¥¼ ì‹¤í–‰í–ˆëŠ”ë° Zookeeperê°€ ì™œ í•„ìš”í•œì§€, ì–´ë–»ê²Œ ì„¤ì •í•˜ë©´ ë˜ëŠ”ì§€ ì•Œì•„ë³´ì.

## **1. Zookeeperë€**

1-1. zookeeperëŠ” Apacheì˜ ì˜¤í”ˆ ì†ŒìŠ¤ í”„ë¡œì íŠ¸ ì¤‘ í•˜ë‚˜ì´ë©°, ê³µê°œ ë¶„ì‚°í˜• êµ¬ì„± ì„œë¹„ìŠ¤, ë™ê¸° ì„œë¹„ìŠ¤ ë° ëŒ€ìš©ëŸ‰ ë¶„ì‚° ì‹œìŠ¤í…œì„ ìœ„í•œ ë„¤ì„ ìŠ¤í˜ì´ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ì œê³µí•¨.

1-2. znode(ì£¼í‚¤í¼ ë…¸ë“œ)ëŠ” ë„¤ì„ ìŠ¤í˜ì´ìŠ¤ ì•ˆì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ë©°, í´ë¼ì´ì–¸íŠ¸ëŠ” znodeë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì½ê±°ë‚˜ ì”€.

1-3. ë¦¬ë” ë…¸ë“œê°€ ì¡´ì¬í•˜ë©°, ë¦¬ë”ë¥¼ ì œì™¸í•œ ë…¸ë“œë“¤ì€ ë¦¬ë”ë¡œë¶€í„° ë°ì´í„°ë¥¼ ë™ê¸°í™”í•¨.

1-4. ë¦¬ë”ê°€ ì¥ì• ê°€ ë°œìƒí•˜ê²Œë˜ë©´ ë‹¤ë¥¸ ë…¸ë“œê°€ ë¦¬ë”ì˜ ì—­í• ì„ ë§¡ì•„ ì•ˆì •ì„±ì´ ë›°ì–´ë‚¨.

1-5. ì¼ë°˜ì ì¸ íŒŒì¼ ì‹œìŠ¤í…œê³¼ ë‹¬ë¦¬ zookeeper ë°ì´í„°ëŠ” ë©”ëª¨ë¦¬ì— ë³´ê´€ë˜ë¯€ë¡œ ë†’ì€ ì²˜ë¦¬ëŸ‰ê³¼ ë‚®ì€ ëŒ€ê¸° ì‹œê°„ì„ ê°–ìŒ.

![img](../.vuepress/public/images/img-kafka/kafka10.png)

Zookeeper êµ¬ì¡°: https://zookeeper.apache.org/doc/current/zookeeperOver.html#sc_designGoals

![img](../.vuepress/public/images/img-kafka/kafka11.png)

Zookeeperì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ êµ¬ì¡°: https://zookeeper.apache.org/doc/current/zookeeperOver.html#sc_designGoals

## 2. [zookeeper.properties](http://zookeeper.properties) íŒŒì¼ ì‚´í´ë³´ê¸°

```bash
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
# 
#    http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# the directory where the snapshot is stored.
dataDir=/tmp/zookeeper
# the port at which the clients will connect
clientPort=2181
# disable the per-ip limit on the number of connections since this is a non-production config
maxClientCnxns=0
# Disable the adminserver by default to avoid port conflicts.
# Set the port to something non-conflicting if choosing to enable this
admin.enableServer=false
# admin.serverPort=8080
```

ì²˜ìŒ íŒŒì¼ì„ ì—´ì–´ë³´ë©´ ì´ë ‡ê²Œ ë˜ì–´ìˆë‹¤. ìœ„ 14 line ê¹Œì§€ëŠ” ë¼ì´ì„ ìŠ¤ ê´€ë ¨ ë‚´ìš©ì´ë‹¤!

ê·¸ ì•„ë˜ë¶€í„° í•˜ë‚˜ì”© ì‚´í´ë³´ì.

```bash
# snapshot ë°ì´í„°ë¥¼ ì €ì¥í•  ê²½ë¡œë¥¼ ì§€ì •
dataDir=C:/dev/kafka_2.13-2.6.0/data/zookeeper
# í´ë¼ì´ì–¸íŠ¸ê°€ connectí•  port ë²ˆí˜¸ ì§€ì •
clientPort=2181
# í•˜ë‚˜ì˜ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë™ì‹œ ì ‘ì†í•˜ëŠ” ê°œìˆ˜ ì œí•œ, ê¸°ë³¸ê°’ì€ 60ì´ë©°, 0ì€ ë¬´ì œí•œ
maxClientCnxns=0
# port ì¶©ëŒì„ ë°©ì§€í•˜ë ¤ë©´ admin server ë¹„í™œì„±í™”(false)
admin.enableServer=false
# admin.serverPort=8080
```

ë©€í‹° ì„œë²„ ì„¤ì •ì„ í•˜ë ¤ë©´ ë‹¤ìŒ ì½”ë“œë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤.

```bash
# ë©€í‹° ì„œë²„ ì„¤ì •
# server.id=host:port:port
server.1=localhost:2888:3888
# server.2=server_host_1:2888:3888
# server.3=server_host_2:2888:3888
 
# ë©€í‹° ì„œë²„ ì„¤ì •ì‹œ ê° ì„œë²„ì˜ dataDir ë°‘ì— myid íŒŒì¼ì´ ìˆì–´ì•¼í•¨.
# echo 1 > myid
 
# ë¦¬ë” ì„œë²„ì— ì—°ê²°í•´ì„œ ë™ê¸°í™”í•˜ëŠ” ì‹œê°„, [ë©€í‹°ì„œë²„ì˜µì…˜]
#initLimit=5
 
# ë¦¬ë” ì„œë²„ë¥¼ ì œì™¸í•œ ë…¸ë“œ ì„œë²„ê°€ ë¦¬ë”ì™€ ë™ê¸°í™”í•˜ëŠ” ì‹œê°„, [ë©€í‹°ì„œë²„ì˜µì…˜]
#syncLimit=2
```

- í•„ìš”í•œ ì„¤ì •ì€ [ê³µì‹ë¬¸ì„œ](https://zookeeper.apache.org/doc/r3.3.3/zookeeperAdmin.html)ì—ì„œ í™•ì¸í•˜ì.

## 3. zookeeper ì‹¤í–‰í•˜ê¸°

```bash
# yj_park@yjpark MINGW64 /c/dev/kafka_2.13-2.6.0
$ ./bin/windows/zookeeper-server-start.bat ./config/zookeeper.properties
```

- `zookeeper-server-start.bat` íŒŒì¼ì€ ì¸ì ê°’ìœ¼ë¡œ `[zookeeper.properties](http://zookeeper.properties)`ë¥¼ ë„˜ê²¨ì£¼ì–´ì•¼ í•œë‹¤.

zookeeperë¥¼ ì‹¤í–‰í•˜ë©´ ìœ„ì—ì„œ ì„¤ì •í•œ **dataDir** ê²½ë¡œì— log, snapshot ë°ì´í„°ê°€ ì €ì¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

í•„ìëŠ” `dev` í´ë”ì—ì„œ ê´€ë¦¬í•˜ê³  ì‹¶ì–´ ê²½ë¡œë¥¼ ìˆ˜ì •í–ˆë‹¤.

zookeeperëŠ” í•„ìš”í•œ ì„¤ì •ì´ ìˆì„ ê²½ìš° ê³µì‹ë¬¸ì„œë¥¼ ì°¸ê³ í•´ propertiesë¥¼ ì¶”ê°€í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ ë  ê²ƒ ê°™ì•„ ê°„ë‹¨íˆ ë³´ê³  ë„˜ì–´ê°„ë‹¤!

ì´ì œ kafka serverì„¤ì •ì„ í•´ë³´ì.

---

**Reference**

- [https://zookeeper.apache.org/doc/r3.3.3/zookeeperAdmin.html](https://zookeeper.apache.org/doc/r3.3.3/zookeeperAdmin.html)
- [https://heodolf.tistory.com/10?category=887831](https://heodolf.tistory.com/10?category=887831)