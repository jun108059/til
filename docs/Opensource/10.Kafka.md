# Kafka ì„¤ì¹˜í•˜ê³  ì‹¤í–‰í•´ë³´ê¸°

---

ì‹¤ìŠµ í™˜ê²½

- ğŸ’¡ Java10 (Java 8ì´ìƒ í•„ìˆ˜)
- ğŸ’¡ Windows 10
- ğŸ’¡ Git Bash

---

## **1. Kafka ë‹¤ìš´ë¡œë“œ**

[*Kafka ê³µì‹ í™ˆí˜ì´ì§€*](https://kafka.apache.org/downloads)ì—ì„œ Kafkaë¥¼ ë‹¤ìš´ë¡œë“œ

- ê¸€ ì“°ëŠ” ì‹œì (2020ë…„11ì›”)ì— ìµœì‹ ë²„ì „ì€ 2020ë…„ 18ì›” ReleaseëœÂ 2.6.0 ì´ë‹¤.

![img](../.vuepress/public/images/img-kafka/kafka07.png)

- Binary downloadsì˜ **Scala 2.13** ë²„ì „ì˜ Kafka ì••ì¶•íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ
- Scalaë¥¼ ì‚¬ìš© ì¤‘ì´ ì•„ë‹ˆë¼ë©´ ê³µì‹í™ˆí˜ì´ì§€ì—ì„œ ì¶”ì²œí•˜ëŠ” 2.13ë²„ì „ì„ ë‹¤ìš´ë¡œë“œí•˜ì.

> *ì„¤ëª…ì„ ì½ì–´ë³´ë©´ ë‚´ê°€ í˜„ì¬ Scalaë¥¼ ì‚¬ìš©í•  ê²½ìš° Kafkaì™€ Scala ë²„ì „ì„ ì¼ì¹˜ì‹œí‚¤ë ¤ë©´ í•´ë‹¹ ë²„ì „ì„ ë‹¤ìš´ë¡œë“œ ë°›ìœ¼ë©´ ëœë‹¤ê³  í•œë‹¤.*

- KafkaëŠ” Scalaë¡œ ê°œë°œë˜ì—ˆê¸° ë•Œë¬¸ì— **Java8+ ë²„ì „ì´ ì„¤ì¹˜**ë˜ì–´ìˆì–´ì•¼ êµ¬ë™í•  ìˆ˜ ìˆë‹¤.
- í•„ìëŠ” [OpenJDK 10](https://openjdk.java.net/projects/jdk/10/) ë²„ì „ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í–ˆë‹¤.

> JAVA PATH ì„¤ì •ì€ ìƒëµ â†’ ì²« ì„¤ì¹˜ë¼ë©´ PATH ì„¤ì •í•´ì£¼ê¸°!

![img](../.vuepress/public/images/img-kafka/kafka08.png)

ë‹¤ìš´ë¡œë“œ ë°›ì€ íŒŒì¼ì€ ì••ì¶•ì„ í’€ë©´ ëœë‹¤.

ì••ì¶•ì„ í‘¸ëŠ” ì—¬ëŸ¬ê°€ì§€ ë°©ë²• ì¤‘ í¸í•œ ë°©ë²•ìœ¼ë¡œ ì••ì¶•ì„ í’€ì.

![img](../.vuepress/public/images/img-kafka/kafka09.png)

ë‹¤ë§Œ, ì••ì¶•ì„ í‘¸ëŠ” ê²½ë¡œë¥¼ ì˜ ì§€ì •í•´ ì¤„ í•„ìš”ê°€ ìˆë‹¤.

- windowsëŠ” ê²½ë¡œëª…ì´ ê¸¸ì–´ì§€ë©´ ì‹¤í–‰ì´ ì•ˆë˜ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

í•„ìëŠ” `C:\dev\kafka_2.13-2.6.0` ê²½ë¡œë¡œ ì§€ì •í•´ì£¼ì—ˆë‹¤.

## 2. Zookeeper ì‹¤í–‰

í˜„ì¬ëŠ” Kafkaë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ Zookeeperê°€ ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ í•œë‹¤. 

> ZookeeperëŠ” kafka í´ëŸ¬ìŠ¤í„°ì˜ ìµœì‹  ì„¤ì • ì •ë³´ ê´€ë¦¬, Kafka ì„œë²„ ë™ê¸°í™”, Leader ì„ íƒ ë“± í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ ì„œë²„ë“¤ì´ ì„œë¡œ ê³µìœ í•˜ëŠ” ë°ì´í„°ë¥¼ ê´€ë¦¬í•´ì¤€ë‹¤!

ê·¸ëŸ°ë° [Apache Kafka QUICKSTART ë¬¸ì„œ](https://kafka.apache.org/quickstart)ì— ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ê³§ Zookeeper ì„¤ì¹˜ê°€ í•„ìš”í•˜ì§€ ì•Šì•„ì§„ë‹¤ê³  í•œë‹¤.

 ~~ë²„ì „ì´ ë” ì˜¬ë¼ê°€ë©´ Kafkaì— Zookeeper ê¸°ëŠ¥ì„ ë‚´ì¥ì‹œí‚¬ ê²ƒ ê°™ë‹¤.~~

```bash
# Start the ZooKeeper service
# Note: Soon, ZooKeeper will no longer be required by Apache Kafka.
```

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ Zookeeper ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•˜ì.

```bash
# yj_park@yjpark MINGW64 /c/dev/kafka_2.13-2.6.0
$ ./bin/windows/zookeeper-server-start.bat ./config/zookeeper.properties
```

> Gitbashë¡œ ì‹¤í–‰í•´ë³¸ ê²°ê³¼  
> bin/windows/zookeeper-server-start.bat config/zookeeper.properties  
> ëª…ë ¹ì–´ë„ ë˜‘ê°™ì´ ì˜ ì‹¤í–‰ëœë‹¤.

**ê° OS ì‹¤í–‰ íŒŒì¼ ìœ„ì¹˜**

Windows10 â†’ /bin/windows/ `bat íŒŒì¼`
Linux â†’ /bin `sh íŒŒì¼`

**ì‹¤í–‰ê²°ê³¼**

```bash
[2020-11-19 17:13:31,112] INFO clientPortAddress is 0.0.0.0:2181 (org.apache.zookeeper.server.quorum.QuorumPeerConfig)
[2020-11-19 17:13:31,112] INFO secureClientPort is not set (org.apache.zookeeper.server.quorum.QuorumPeerConfig)
[2020-11-19 17:13:31,112] INFO Starting server (org.apache.zookeeper.server.ZooKeeperServerMain)
[2020-11-19 17:13:31,112] INFO zookeeper.snapshot.trust.empty : false (org.apache.zookeeper.server.persistence.FileTxnSnapLog)
[2020-11-19 17:13:31,112] INFO Server environment:zookeeper.version=3.5.8-f439ca583e70862c3068a1f2a7d4d068eec33315, built on 05/04/2020 15:53 GMT (org.apache.zookeeper.server.ZooKeeperServer)
[2020-11-19 17:13:31,112] INFO Server environment:host.name=host.docker.internal (org.apache.zookeeper.server.ZooKeeperServer)
[2020-11-19 17:13:31,112] INFO Server environment:java.version=10 (org.apache.zookeeper.server.ZooKeeperServer)
[2020-11-19 17:13:31,127] INFO Server environment:java.vendor=Oracle Corporation (org.apache.zookeeper.server.ZooKeeperServer)
[2020-11-19 17:13:31,127] INFO Server environment:java.home=C:\source\Java\jdk-10 (org.apache.zookeeper.server.ZooKeeperServer)
# ... ìƒëµ
[2020-11-19 17:13:31,127] INFO Created server with tickTime 3000 minSessionTimeout 6000 maxSessionTimeout\version-2 snapdir \tmp\zookeeper\version-2 (org.apache.zookeeper.server.ZooKeeperServer)
[2020-11-19 17:13:31,174] INFO Using or
g.apache.zookeeper.server.NIOServerCnxnFactory as server connectioer.server.Se  rverCnxnFactory)
[2020-11-19 17:13:31,190] INFO Configuring NIO connection handler with 10s sessionless connection timeoutrker threads, and 64 kB direct buffers. (org.apache.zookeeper.server.NIOServerCnxnFactory)
[2020-11-19 17:13:31,237] INFO binding to port 0.0.0.0/0.0.0.0:2181 (org.apache.zookeeper.server.NIOServerCnxnFactory)
[2020-11-19 17:13:31,308] INFO zookeeper.snapshotSizeFactor = 0.33 (org.apache.zookeeper.server.ZKDatabase)
[2020-11-19 17:13:31,312] INFO Snapshotting: 0x0 to \tmp\zookeeper\version-2\snapshot.0 (org.apache.zookexnSnapLog)
[2020-11-19 17:13:31,321] INFO Snapshotting: 0x0 to \tmp\zookeeper\version-2\snapshot.0 (org.apache.zookexnSnapLog)
[2020-11-19 17:13:31,340] INFO Using checkIntervalMs=60000 maxPerMinute=10000 (org.apache.zookeeper.serve.ContainerManager)[2020-11-19 17:14:47,878] INFO Creating new log file: log.1 (org.apache.zookeeper.server.persistence.FileTxnLog)
# ... ìƒëµ
```

ì˜ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

- **zookeeper-server-start.bat**
    - ìœˆë„ìš°ì—ì„œ zookeeper ì„œë²„ë¥¼ ì‹¤í–‰í•˜ëŠ” íŒŒì¼
- **zookeeper.properties**
    - zookeeper ì„œë²„ ì„¤ì • íŒŒì¼
    - í¬íŠ¸ ë°”ì¸ë”© ë“± ì„¤ì • ê°€ëŠ¥ (default = 2181í¬íŠ¸)
    - ì¶”ê°€ì ì¸ ì„¤ì •ì€ **[ê³µì‹ë¬¸ì„œ](https://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html#sc_configuration)**ë¥¼ í™•ì¸

## 3. Kafka ì‹¤í–‰

ìƒˆë¡œìš´ í„°ë¯¸ë„ì„ ì—´ì–´ì„œ Kafkaë¥¼ ì‹¤í–‰í•´ì£¼ì.

ë§ˆì°¬ê°€ì§€ë¡œ kafka ì••ì¶•ì„ í‘¼ base í´ë”ë¡œ ì´ë™í•œ í›„ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ëœë‹¤.

```bash
# yj_park@yjpark MINGW64 /c/dev/kafka_2.13-2.6.0
$ bin/windows/kafka-server-start.bat config/server.properties
```

**ì‹¤í–‰ê²°ê³¼**

```bash
[2020-11-23 13:46:51,229] INFO Registered kafka:type=kafka.Log4jController MBean (kafka.utils.Log4jControllerRegistration$)
[2020-11-23 13:46:51,618] INFO Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation (org.apache.zookeeper.common.X509Util)
[2020-11-23 13:46:51,699] INFO starting (kafka.server.KafkaServer)
[2020-11-23 13:46:51,700] INFO Connecting to zookeeper on localhost:2181 (kafka.server.KafkaServer)
[2020-11-23 13:46:51,718] INFO [ZooKeeperClient Kafka server] Initializing a new session to localhost:2181. (kafka.zookeeper.ZooKeeperClient)
# ... ìƒëµ
[2020-11-23 13:46:53,517] INFO [SocketServer brokerId=0] Started socket server acceptors and processors (kafka.network.SocketServer)
[2020-11-23 13:46:53,527] INFO Kafka version: 2.6.0 (org.apache.kafka.common.utils.AppInfoParser)
[2020-11-23 13:46:53,527] INFO Kafka commitId: 62abe01bee039651 (org.apache.kafka.common.utils.AppInfoParser)
[2020-11-23 13:46:53,527] INFO Kafka startTimeMs: 1606106813517 (org.apache.kafka.common.utils.AppInfoParser)
[2020-11-23 13:46:53,529] INFO [KafkaServer id=0] started (kafka.server.KafkaServer)
```

ì˜ ì‹¤í–‰ëë‹¤.

- **kafka-server-start.bat**
    - ìœˆë„ìš° OSì—ì„œ kafka ì„œë²„ ì‹¤í–‰ íŒŒì¼
- **server.properties**
    - Kafka ê´€ë ¨ ì„¤ì • íŒŒì¼
    - ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œ ì„¤ì • íŒŒì¼ ë‚´ë¶€ë¥¼ ê°„ë‹¨íˆ ì‚´í´ë³´ê² ë‹¤.
    - ìì„¸í•œ ë‚´ìš©ì€ [**ê³µì‹ë¬¸ì„œ**](https://kafka.apache.org/documentation/#configuration)ë¥¼ í™•ì¸

## 4. ì‹¤í–‰ í™•ì¸

### 1ï¸âƒ£ zookeeper server í™•ì¸

```bash
[2020-11-23 13:45:18,432] INFO clientPortAddress is 0.0.0.0:2181 (org.apache.zookeeper.server.quorum.QuorumPeerConfig)
```

- ê¸°ë³¸ portì¸ 2181ë¡œ Clientê°€ ë°”ì¸ë”©ëœë‹¤.

### 2ï¸âƒ£ kafka server í™•ì¸

```bash
[2020-11-23 13:46:51,699] INFO starting (kafka.server.KafkaServer)
[2020-11-23 13:46:51,700] INFO Connecting to zookeeper on localhost:2181 (kafka.server.KafkaServer)
[2020-11-23 13:46:51,718] INFO [ZooKeeperClient Kafka server] Initializing a new session to localhost:2181. (kafka.zookeeper.ZooKeeperClient)
```

- kafka serverê°€ ì‹¤í–‰ë˜ê³  zookeeperì— ì—°ê²°ëœë‹¤ (ë§ˆì°¬ê°€ì§€ë¡œ 2181 port)

### 3ï¸âƒ£ kafka ì‹¤í–‰ í™•ì¸

```bash
[2020-11-23 13:46:53,527] INFO Kafka version: 2.6.0 (org.apache.kafka.common.utils.AppInfoParser)
[2020-11-23 13:46:53,527] INFO Kafka commitId: 62abe01bee039651 (org.apache.kafka.common.utils.AppInfoParser)
[2020-11-23 13:46:53,527] INFO Kafka startTimeMs: 1606106813517 (org.apache.kafka.common.utils.AppInfoParser)
[2020-11-23 13:46:53,529] INFO [KafkaServer id=0] started (kafka.server.KafkaServer)
```

- Kafka ì‹¤í–‰ì´ ì •ìƒì ìœ¼ë¡œ ëë‹¤.

ì‹¤í–‰ì€ ì˜ëëŠ”ë° í…ŒìŠ¤íŠ¸ í•˜ê¸° ì•ì„œ ë‹¤ìŒ í¬ìŠ¤íŒ…ìœ¼ë¡œ properties ì„¤ì • íŒŒì¼ì´ ì–´ë–¤ êµ¬ì¡°ë¡œ ë˜ì–´ìˆëŠ”ì§€ ë¨¼ì € íŒŒì•…í•´ë³´ë ¤ê³  í•œë‹¤.

**Reference**

- [https://kafka.apache.org/quickstart](https://kafka.apache.org/quickstart)
- [https://heodolf.tistory.com/8?category=887831](https://heodolf.tistory.com/8?category=887831)