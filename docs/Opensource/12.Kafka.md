# Kafka ì„¤ì •í•˜ê¸°

---

ì‹¤ìŠµ í™˜ê²½

- ğŸ’¡ Java10 (Java 8ì´ìƒ í•„ìˆ˜)
- ğŸ’¡ Windows 10
- ğŸ’¡ Git Bash

---

Kafkaì˜ ê°œë…ê³¼ ë„ì… ì´ìœ ëŠ” ì§€ë‚œ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£¨ì—ˆê³ , ë°”ë¡œ ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ **zookeeper-server**ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ **zookeeper.properties**ë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ë‹¤.

ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” **kafka-server**ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ **server.properties** ì½”ë“œë¥¼ ë¶„ì„í•´ë³´ì.

## 1. server.properties ì½”ë“œ ë¶„ì„

> ì´ì „ì— ì‚´í´ë³¸ ê²ƒ ì²˜ëŸ¼ kafkaë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ **kafka-server-start.bat** íŒŒì¼ì— ì¸ì ê°’ìœ¼ë¡œ [server.pro](http://server.pro)perties ì†ì„±ì„ ì£¼ì–´ì•¼í–ˆë‹¤.

- **kafka-server-start.bat**
    - ìœˆë„ìš° OSì—ì„œ kafka ì„œë²„ ì‹¤í–‰ íŒŒì¼
- **server.properties**
    - Kafka ê´€ë ¨ ì„¤ì • íŒŒì¼

ì„¤ì • íŒŒì¼ ë‚´ë¶€ë¥¼ ê°„ë‹¨íˆ ì‚´í´ë³´ì.

```bash
# config/server.properties

############################# Server Basics #############################

# Brokerì˜ IDë¡œ Clusterë‚´ Brokerë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ì‚¬ìš©(Unique ê°’)
broker.id=0
 
############################# Socket Server Settings #############################

# Brokerê°€ ì‚¬ìš©í•˜ëŠ” í˜¸ìŠ¤íŠ¸ì™€ í¬íŠ¸ë¥¼ ì§€ì •, í˜•ì‹ì€ PLAINTEXT://your.host.name:port ì„ ì‚¬ìš©
listeners=PLAINTEXT://:9092
 
# Producerì™€ Consumerê°€ ì ‘ê·¼í•  í˜¸ìŠ¤íŠ¸ì™€ í¬íŠ¸ë¥¼ ì§€ì •, ê¸°ë³¸ê°’ì€ listenersë¥¼ ì‚¬ìš©
advertised.listeners=PLAINTEXT://localhost:9092

# ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” Threadì˜ ê°œìˆ˜, ê¸°ë³¸ê°’ 3
num.network.threads=3
 
# I/Oê°€ ìƒê¸¸ë•Œ ë§ˆë‹¤ ìƒì„±ë˜ëŠ” Threadì˜ ê°œìˆ˜, ê¸°ë³¸ê°’ 8
num.io.threads=8

# socket ì„œë²„ê°€ ì‚¬ìš©í•˜ëŠ” ì†¡ìˆ˜ì‹  ë²„í¼ (SO_SNDBUF, SO_RCVBUF) ì‚¬ì´ì¦ˆ, ê¸°ë³¸ê°’ 102400
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
 
# ì„œë²„ê°€ ë°›ì„ ìˆ˜ ìˆëŠ” ìµœëŒ€ ìš”ì²­ ì‚¬ì´ì¦ˆì´ë©°, ì„œë²„ ë©”ëª¨ë¦¬ê°€ ê³ ê°ˆ ë˜ëŠ” ê²ƒ ë°©ì§€
# JAVAì˜ Heap ë³´ë‹¤ ì‘ê²Œ ì„¤ì •í•´ì•¼ í•¨, ê¸°ë³¸ê°’ 104857600
socket.request.max.bytes=104857600
 
############################# Log Basics #############################

# ë¡œê·¸ íŒŒì¼ì„ ì €ì¥í•  ë””ë ‰í„°ë¦¬ì˜ ì‰¼í‘œë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆìŒ
log.dirs=C:/dev/kafka_2.13-2.6.0/logs

# í† í”½ë‹¹ íŒŒí‹°ì…˜ì˜ ìˆ˜ë¥¼ ì˜ë¯¸, 
# ì…ë ¥í•œ ìˆ˜ë§Œí¼ ë³‘ë ¬ì²˜ë¦¬ ê°€ëŠ¥, ë°ì´í„° íŒŒì¼ë„ ê·¸ë§Œí¼ ëŠ˜ì–´ë‚¨
num.partitions=1

# ì‹œì‘ ì‹œ log ë³µêµ¬ ë° ì¢…ë£Œ ì‹œ flushingì— ì‚¬ìš©í•  ë°ì´í„° directoryë‹¹ Thread ê°œìˆ˜
# ì´ ê°’ì€ RAID ë°°ì—´ì— ë°ì´í„° directoryì— ëŒ€í•´ ì¦ê°€í•˜ë„ë¡ ê¶Œì¥ ë¨
num.recovery.threads.per.data.dir=1

############################# Internal Topic Settings #############################
# ë‚´ë¶€ Topicì¸ "_consumer_offsets", "_transaction_state"ì— ëŒ€í•œ replication factor
# ê°œë°œí™˜ê²½ : 1, ìš´ì˜í•  ê²½ìš° ê°€ìš©ì„± ë³´ì¥ì„ ìœ„í•´ 1 ì´ìƒ ê¶Œì¥(3 ì •ë„)
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1

############################# Log Retention Policy #############################

# ì„¸ê·¸ë¨¼íŠ¸ íŒŒì¼ì˜ ì‚­ì œ ì£¼ê¸°, ê¸°ë³¸ê°’ hours, 168ì‹œê°„(7ì¼)
# ì˜µì…˜ [ bytes, ms, minutes, hours ] 
log.retention.hours=168

# í† í”½ë³„ë¡œ ìˆ˜ì§‘í•œ ë°ì´í„°ë¥¼ ë³´ê´€í•˜ëŠ” íŒŒì¼
# ì„¸ê·¸ë¨¼íŠ¸ íŒŒì¼ì˜ ìµœëŒ€ í¬ê¸°, ê¸°ë³¸ê°’ 1GB
# ì„¸ê·¸ë¨¼íŠ¸ íŒŒì¼ì˜ ìš©ëŸ‰ì´ ì°¨ë©´ ìƒˆë¡œìš´ íŒŒì¼ì„ ìƒì„±
log.segment.bytes=1073741824

# ì„¸ê·¸ë¨¼íŠ¸ íŒŒì¼ì˜ ì‚­ì œ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” ì£¼ê¸°, ê¸°ë³¸ê°’ 5ë¶„(ë³´ì¡´ ì •ì±…)
log.retention.check.interval.ms=300000

############################# Zookeeper #############################

# ì£¼í‚¤í¼ì˜ ì ‘ì† ì •ë³´
# ì‰¼í‘œ(,)ë¡œ ë§ì€ ì—°ê²° ì„œë²„ í¬íŠ¸ ì„¤ì • ê°€ëŠ¥
# ëª¨ë“  kafka znodeì˜ Root directory
zookeeper.connect=localhost:2181
 
# ì£¼í‚¤í¼ ì ‘ì† ì‹œë„ ì œí•œì‹œê°„(time out)
zookeeper.connection.timeout.ms=18000

############################# Group Coordinator Settings #############################

# GroupCoordinator ì„¤ì • - ì»¨ìŠˆë¨¸ rebalanceë¥¼ ì§€ì—°ì‹œí‚¤ëŠ” ì‹œê°„
# ê°œë°œí™˜ê²½ : í…ŒìŠ¤íŠ¸ í¸ë¦¬ë¥¼ ìœ„í•´ 0ìœ¼ë¡œ ì •ì˜
# ìš´ì˜í™˜ê²½ : 3ì´ˆì˜ ê¸°ë³¸ê°’ì„ ì„¤ì •í•˜ëŠ”ê²Œ ì¢‹ìŒ
 group.initial.rebalance.delay.ms=0
```

ë” í•„ìš”í•œ ì„¤ì •ì€ [ê³µì‹ë¬¸ì„œ](https://kafka.apache.org/documentation/#configuration)ë¥¼ í™•ì¸í•˜ê³  ì¶”ê°€í•˜ë©´ ë  ê²ƒ ê°™ë‹¤!

## 2. Kafka ì‹¤í–‰

zookeeperë¥¼ ì‹¤í–‰í•œ ì´í›„ì— ìƒˆë¡œìš´ í„°ë¯¸ë„ì„ ì—´ì–´ì„œ Kafkaë¥¼ ì‹¤í–‰í•´ì£¼ë©´ ë³€ê²½í•œ ì„¤ì •ë“¤ì´ ì ìš©ë˜ê³  ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.

```bash
# yj_park@yjpark MINGW64 /c/dev/kafka_2.13-2.6.0
$ bin/windows/kafka-server-start.bat config/server.properties
```

**ì‹¤í–‰ê²°ê³¼**

```bash
[2020-11-23 13:46:51,229] INFO Registered kafka:type=kafka.Log4jController MBean (kafka.utils.Log4jControllerRegistration$)
[2020-11-23 13:46:51,618] INFO Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation (org.apache.zookeeper.common.X509Util)
[2020-11-23 13:46:51,699] INFO starting (kafka.server.KafkaServer)
[2020-11-23 13:46:51,700] INFO Connecting to zookeeper on localhost:2181 (kafka.server.KafkaServer)
[2020-11-23 13:46:51,718] INFO [ZooKeeperClient Kafka server] Initializing a new session to localhost:2181. (kafka.zookeeper.ZooKeeperClient)
# ... ìƒëµ
[2020-11-23 13:46:53,517] INFO [SocketServer brokerId=0] Started socket server acceptors and processors (kafka.network.SocketServer)
[2020-11-23 13:46:53,527] INFO Kafka version: 2.6.0 (org.apache.kafka.common.utils.AppInfoParser)
[2020-11-23 13:46:53,527] INFO Kafka commitId: 62abe01bee039651 (org.apache.kafka.common.utils.AppInfoParser)
[2020-11-23 13:46:53,527] INFO Kafka startTimeMs: 1606106813517 (org.apache.kafka.common.utils.AppInfoParser)
[2020-11-23 13:46:53,529] INFO [KafkaServer id=0] started (kafka.server.KafkaServer)
```

ì´ì œ Kafka ê¸°ë³¸ í™˜ê²½ì´ ì„¤ì •ëë‹¤!

**Reference**

- [https://kafka.apache.org/quickstart](https://kafka.apache.org/quickstart)
- [https://kafka.apache.org/documentation/#configuration](https://kafka.apache.org/documentation/#configuration)
- [https://heodolf.tistory.com/8?category=887831](https://heodolf.tistory.com/8?category=887831)