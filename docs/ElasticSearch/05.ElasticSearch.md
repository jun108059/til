# ElasticSearch ë§¤í•‘(Mapping)

![img](../.vuepress/public/images/img-es/1.elasticsearchLogo.png)  

---

### ì‹¤ìŠµ í™˜ê²½
### ğŸ’¡ Elasticsearch 7.9.0
### ğŸ’¡ Windows 10
### ğŸ’¡ Git Bash

---

`Mapping`ì€ RDBì—ì„œ ìŠ¤í‚¤ë§ˆì™€ ê°™ì€ ê°œë…ì´ë‹¤.

ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ ì‚´í´ë³¸ ê²ƒì²˜ëŸ¼ `Mapping` ì—†ì´ë„ ë°ì´í„°ë¥¼ ë„£ê³  ì½ì„ ìˆ˜ ìˆì—ˆë‹¤.

í•˜ì§€ë§Œ ì‹¤ì œë¡œ ì„œë¹„ìŠ¤ë¥¼ í•  ë•Œ `Mapping`ì„ í•˜ì§€ ì•Šì„ ê²½ìš° ì—¬ëŸ¬ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

- Documentì— ë‚ ì§œë¥¼ ë„£ê³  ì‹¶ì€ë° ë‹¨ìˆœíˆ í…ìŠ¤íŠ¸ë¡œ ë“¤ì–´ê°„ë‹¤.

ì™€ ê°™ì€ ìƒí™©ì— `Kibana` ë“±ì˜ ê°€ì‹œí™” ë„êµ¬ì™€ ë¶„ì„ì„ í•  ë•Œ íƒ€ì…ì´ ë§ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ëŒ€í‘œì ì´ë‹¤.

---

ì‹¤ìŠµì—ì„œ ì‚¬ìš©í•  ë°ì´í„°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

`Mapping` ì‹¤ìŠµì„ í•˜ê¸°ìœ„í•´ Indexë¥¼ ë¨¼ì € ì‚­ì œí•œ ì´í›„ì— ë‹¤ì‹œ ìƒì„±í•˜ê² ë‹¤.

---

## 1. Index ì‚­ì œí•˜ê³  ë‹¤ì‹œ ë§Œë“¤ê¸°

### âœ” ì‚­ì œí•˜ê¸°

```bash
$ curl -XDELETE http://localhost:9200/classes?pretty
```

### âœ” ìƒì„±í•˜ê¸°

```bash
$ curl -XPUT http://localhost:9200/classes?pretty
```

### âœ” í™•ì¸í•˜ê¸°

```bash
$ curl -XGET http://localhost:9200/classes?pretty
```

ê²°ê³¼ë¥¼ ë³´ë©´ `mappings` ë¶€ë¶„ì´ ë¹„ì–´ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```bash
{
  "classes" : {
    "aliases" : { },
    "mappings" : { },
    "settings" : {
      "index" : {
        "creation_date" : "1598314352997",
        "number_of_shards" : "1",
        "number_of_replicas" : "1",
        "uuid" : "vLmOaHZLRMW_7kOZbi0ZRg",
        "version" : {
          "created" : "7090099"
        },
        "provided_name" : "classes"
      }
    }
  }
}
```

---

## 2. Mapping ìƒì„±í•˜ê¸°

`Mapping`ìœ¼ë¡œ ë°ì´í„° íƒ€ì…ì„ ë¯¸ë¦¬ ì§€ì •í•´ì£¼ê¸° ìœ„í•´ mapping JSON íŒŒì¼ì´ ìˆì–´ì•¼í•œë‹¤.

> ì°¸ê³ í•œ ê°•ì˜ì—ì„œëŠ” mapping typeì„ `string`ìœ¼ë¡œ ì£¼ì—ˆëŠ”ë° ì´ëŠ” 6.x ë²„ì „ë¶€í„° `text`ë¡œ ë°”ë€Œì—ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì„ ë³´ê³ ì‹¶ë‹¤ë©´ í¬ìŠ¤íŒ… ì¤‘ [Error-handling](Error-handling.md)ì„ í™•ì¸í•˜ê±°ë‚˜, [stackoverflow](https://stackoverflow.com/questions/47452770/no-handler-for-type-string-declared-on-field-name) ë‚´ìš©ì„ ì½ì–´ë³¼ ê²ƒì„ ê¶Œì¥í•œë‹¤.

```JSON
{
	"class" : {
		"properties" : {
			"title" : {
				"type" : "text"
			},
			"professor" : {
				"type" : "text"
			},
			"major" : {
				"type" : "text"
			},
			"semester" : {
				"type" : "text"
			},
			"student_count" : {
				"type" : "integer"
			},
			"unit" : {
				"type" : "integer"
			},
			"rating" : {
				"type" : "integer"
			},
			"submit_date" : {
				"type" : "date",
				"format" : "yyyy-MM-dd"
			},
			"school_location" : {
				"type" : "geo_point"
			}
		}
	}
}
```

ë‹¤ìŒê³¼ ê°™ì€ `JSON` íŒŒì¼ë¡œ mapping ì‹œì¼œë³´ì.

---

X PUT ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ mappingì„ ìƒì„±í•œë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ì…ë ¥í•˜ë©´ ëœë‹¤.

`curl -XPUT 'http://localhost:9200/classes/class/_mapping' -d @classesRating_mapping.json`

ì§€ë‚œ í¬ìŠ¤íŒ…ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ Windowsì—ì„œëŠ” Content-Type ì„ H ì˜µì…˜ìœ¼ë¡œ ì…ë ¥í•´ì¤˜ì•¼í•œë‹¤.

ê·¸ë¦¬ê³  7.x ë²„ì „ì€ [ê³µì‹ ë¬¸ì„œ](https://www.elastic.co/kr/blog/moving-from-types-to-typeless-apis-in-elasticsearch-7-0)ì— ë‚˜ì™€ìˆëŠ” ê²ƒê³¼ ê°™ì´ ë¬´í˜•ì‹ APIë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ `include_type_name=true`ë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤.

```bash
$ curl -XPUT 'http://localhost:9200/classes/class/_mapping?include_type_name=true&pretty' -d @classesRating_mapping.json -H 'Content-Type: application/json'
```

Error ì—†ì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ëë‹¤ë©´ class íƒ€ì…ì— mappingì´ ì¶”ê°€ëœ ê²ƒì´ë‹¤.

í™•ì¸í•´ë³´ì!

```bash
$ curl -XGET http://localhost:9200/classes?pretty
```

ê²°ê³¼

```bash
{
  "classes" : {
    "aliases" : { },
    "mappings" : {
      "properties" : {
        "major" : {
          "type" : "text"
        },
        "professor" : {
          "type" : "text"
        },
        "rating" : {
          "type" : "integer"
        },
        "school_location" : {
          "type" : "geo_point"
        },
        "semester" : {
          "type" : "text"
        },
        "student_count" : {
          "type" : "integer"
        },
        "submit_date" : {
          "type" : "date",
          "format" : "yyyy-MM-dd"
        },
        "title" : {
          "type" : "text"
        },
        "unit" : {
          "type" : "integer"
        }
      }
    },
    "settings" : {
      "index" : {
        "creation_date" : "1598314352997",
        "number_of_shards" : "1",
        "number_of_replicas" : "1",
        "uuid" : "vLmOaHZLRMW_7kOZbi0ZRg",
        "version" : {
          "created" : "7090099"
        },
        "provided_name" : "classes"
      }
    }
  }
}
```

ì°¸ê³ ë¡œ type ì¤‘ `geo_point`ëŠ” ì§€ë„ì— ì‹¤ì œ ìœ„ì¹˜ë¥¼ ë„ì–´ì¤„ ìˆ˜ ìˆëŠ” typeì´ë‹¤.

## 3. ì‹¤ì œ ë°ì´í„°ë¥¼ Indexì— bulkí•˜ê¸°

ì—¬ëŸ¬ `Document`ë¥¼ `bulk`ë¡œ í•œë²ˆì— ë„£ì–´ë³´ì.

### âœ” Bulk í•˜ê¸°

```bash
$ curl -XPOST http://localhost:9200/_bulk?pretty --data-binary @classes.json -H 'Content-Type: application/json'
```

### âœ” í™•ì¸í•˜ê¸°

```bash
$ curl -XGET http://localhost:9200/classes/class/1/?pretty
```

ê²°ê³¼

```bash
{
  "_index" : "classes",
  "_type" : "class",
  "_id" : "1",
  "_version" : 1,
  "_seq_no" : 0,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "Machine Learning",
    "Professor" : "YoungJun Park",
    "major" : "Computer Science",
    "semester" : [
      "spring",
      "fall"
    ],
    "student_count" : 100,
    "unit" : 3,
    "rating" : 5,
    "submit_date" : "2020-01-02",
    "school_location" : {
      "lat" : 36.0,
      "lon" : -120.0
    }
  }
}

```

Mapping typeì´ ì •ìƒì ìœ¼ë¡œ ì…ë ¥ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤!

---

> ë³¸ í¬ìŠ¤íŒ…ì€ `Inflearn`ì˜ [ELK ìŠ¤íƒ (ElasticSearch, Logstash, Kibana) ìœ¼ë¡œ ë°ì´í„° ë¶„ì„](https://www.inflearn.com/course/elk-%EC%8A%A4%ED%83%9D-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D) ê°•ì˜ë¥¼ ì°¸ê³ í•˜ì—¬ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---