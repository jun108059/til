# ElasticSearch λ²ν¬(Bulk)

![img](../.vuepress/public/images/img-es/1.elasticsearchLogo.png)  

---

### μ‹¤μµ ν™κ²½

- π’΅ Elasticsearch 7.9.0
- π’΅ Windows 10
- π’΅ Git Bash

---

Bulkλ” κ°„λ‹¨ν μ„¤λ…ν•λ©΄ μ—¬λ¬κ°μ Document(λ°μ΄ν„°)λ¥Ό ν•λ²μ— `ES`μ— μ‚½μ…ν•λ” λ°©λ²•μ΄λ‹¤.

## 1. BULK POST

λ…λ Ήμ–΄ κµ¬μ΅°λ” λ‹¤μκ³Ό κ°™λ‹¤.

`curl -XPOST "/ESμ£Όμ†/"_bulk --data-binary @"fileλ…".json`

μ‹¤μ λ΅ μ‚¬μ©ν•΄λ³΄μ.

μ‚½μ…ν•κ³ μ ν•λ” Document λ‚΄μ©μ„ [JSON file](https://github.com/jun108059/til/blob/master/practice/ElasticSearch/classes.json)μ—μ„ ν™•μΈν•΄λ³΄λ©΄

- **μ²« λ²μ§Έ Line** : Meta information
- **λ‘ λ²μ§Έ Line** : μ‹¤μ  λ“¤μ–΄κ° κ°’

```JSON
{ "index" : { "_index" : "classes", "_type" : "class", "_id" : "1" } }
{"title" : "Machine Learning","Professor" : "YoungJun Park","major" : "Computer Science","semester" : ["spring", "fall"],"student_count" : 100,"unit" : 3,"rating" : 5, "submit_date" : "2020-01-02", "school_location" : {"lat" : 36.00, "lon" : -120.00}}
```

μ΄λ ‡κ² `2 Line` μ”© λ°λ³µλλ” ν¬λ§·μ΄ μ €μ¥λμ–΄μλ‹¤.

> POST λ…λ Ήμ–΄λ΅ μ‚½μ…ν•΄λ³΄μ.

```bash
$ curl -XPOST http://localhost:9200/_bulk?pretty --data-binary @classes.json -H 'Content-Type: application/json'
```

> λ§μ•½ Bulk Request Errorκ°€ λ°μƒν•λ‹¤λ©΄ JSON file λ§μ§€λ§‰μ— μ—”ν„°λ¥Ό μ…λ ¥ν•΄ `New Line`μ„ μ…λ ¥ν•΄μ£Όλ©΄ λλ‹¤.

μ λ“¤μ–΄κ°”λ”μ§€ `1λ² id`λ¶€ν„° ν™•μΈν•΄λ³΄μ.

```bash
$ curl -XGET http://localhost:9200/classes/class/1/?pretty
```

κ²°κ³Ό

```bash
{
  "_index" : "classes",
  "_type" : "class",
  "_id" : "1",
  "_version" : 7,
  "_seq_no" : 6,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "Machine Learning",
    "Professor" : "YoungJun Park",
    "major" : "Computer Science",
    "semester" : [
      "spring",
      "fall"
    ],
    "student_count" : 100,
    "unit" : 3,
    "rating" : 5,
    "submit_date" : "2020-01-02",
    "school_location" : {
      "lat" : 36.0,
      "lon" : -120.0
    }
  }
}
```

---

`2λ² id`λ„ ν™•μΈν•΄λ³΄λ©΄

```bash
$ curl -XGET http://localhost:9200/classes/class/2/?pretty
```

κ²°κ³Ό

```bash
{
  "_index" : "classes",
  "_type" : "class",
  "_id" : "2",
  "_version" : 1,
  "_seq_no" : 7,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "Network",
    "Professor" : "YoungJun Park",
    "major" : "Computer Science",
    "semester" : [
      "fall"
    ],
    "student_count" : 50,
    "unit" : 3,
    "rating" : 4,
    "submit_date" : "2020-02-02",
    "school_location" : {
      "lat" : 36.0,
      "lon" : -120.0
    }
  }
}
```

μ μ‚½μ…λ κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

---
