# ElasticSearch ë°ì´í„° ì¡°íšŒ(Search)

![img](../.vuepress/public/images/img-es/1.elasticsearchLogo.png)  

---

### ì‹¤ìŠµ í™˜ê²½

- ğŸ’¡ Elasticsearch 7.9.0
- ğŸ’¡ Windows 10
- ğŸ’¡ Git Bash
---

ElasticSearchì— ë©”ì¸ ê¸°ëŠ¥ì´ë¼ê³  ë³¼ ìˆ˜ ìˆëŠ” `Search`ë¥¼ ì‹¤ìŠµí•´ë³´ì.

ë¨¼ì € sample ë°ì´í„°ë¥¼ `bulk`í•´ë³´ì.

[sample ë°ì´í„° ì†ŒìŠ¤](https://github.com/jun108059/til/blob/master/practice/ElasticSearch/simple_basketball.json)

```JSON
{ "index" : { "_index" : "basketball", "_type" : "record", "_id" : "1" } }
{"team" : "Chicago Bulls","name" : "Michael Jordan", "points" : 30,"rebounds" : 3,"assists" : 4, "submit_date" : "1996-10-11"}
{ "index" : { "_index" : "basketball", "_type" : "record", "_id" : "2" } }
{"team" : "Chicago Bulls","name" : "Michael Jordan","points" : 20,"rebounds" : 5,"assists" : 8, "submit_date" : "1996-10-11"}
```

---

## 1. Indexì— ë°ì´í„° Bulkí•˜ê¸°

ìœ„ì—ì„œ í™•ì¸í•œ sample ë°ì´í„°ë¥¼ ì‚½ì…í•˜ë©´

`curl -XPOST "/ESì£¼ì†Œ/"_bulk --data-binary @"fileëª…".json`

```bash
$ curl -XPOST 'http://localhost:9200/_bulk?pretty' --data-binary @simple_basketball.json -H 'Content-Type: application/json'
```

ê²°ê³¼

```bash
{
  "took" : 423,
  "errors" : false,
  "items" : [
    {
      "index" : {
        "_index" : "basketball",
        "_type" : "record",
        "_id" : "1",
        "_version" : 1,
        "result" : "created",
        "_shards" : {
          "total" : 2,
          "successful" : 1,
          "failed" : 0
        },
        "_seq_no" : 0,
        "_primary_term" : 1,
        "status" : 201
      }
    },
    {
      "index" : {
        "_index" : "basketball",
        "_type" : "record",
        "_id" : "2",
        "_version" : 1,
        "result" : "created",
        "_shards" : {
          "total" : 2,
          "successful" : 1,
          "failed" : 0
        },
        "_seq_no" : 1,
        "_primary_term" : 1,
        "status" : 201
      }
    }
  ]
}
```

ì˜ bulk ëë‹¤!

---

## 2. âœ” _search : ì˜µì…˜ ì—†ì´ ì‚¬ìš©

```bash
$ curl -XGET 'http://localhost:9200/basketball/record/_search?pretty'
```

ëª¨ë“  `document`ê°€ ë‹¤ ì¶œë ¥ëœë‹¤!

ê²°ê³¼

```bash
{
  "took" : 7,
  "timed_out" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : {
      "value" : 2,
      "relation" : "eq"
    },
    "max_score" : 1.0,
    "hits" : [
      {
        "_index" : "basketball",
        "_type" : "record",
        "_id" : "1",
        "_score" : 1.0,
        "_source" : {
          "team" : "Chicago Bulls",
          "name" : "Michael Jordan",
          "points" : 30,
          "rebounds" : 3,
          "assists" : 4,
          "submit_date" : "1996-10-11"
        }
      },
      {
        "_index" : "basketball",
        "_type" : "record",
        "_id" : "2",
        "_score" : 1.0,
        "_source" : {
          "team" : "Chicago Bulls",
          "name" : "Michael Jordan",
          "points" : 20,
          "rebounds" : 5,
          "assists" : 8,
          "submit_date" : "1996-10-11"
        }
      }
    ]
  }
}
```

## 3. âœ” _search : URI ì˜µì…˜

serach ì˜µì…˜ ì¤‘ URI ì˜µì…˜ì„ ì‚¬ìš©í•´ë³´ì.

`basketball` Index ì¤‘ `points = 30`ì¸ ë°ì´í„°ë§Œ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ Queryë¥¼ ë‚ ë¦¬ë©´ ëœë‹¤.

```bash
$ curl -XGET 'http://localhost:9200/basketball/record/_search?q=points:30&pretty'
```

`points`ê°€ `30`ì¸ í•˜ë‚˜ì˜ ë°ì´í„°ê°€ ë°˜í™˜ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ê²°ê³¼

```bash
{
  "took" : 25,
  "timed_out" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : {
      "value" : 1,
      "relation" : "eq"
    },
    "max_score" : 1.0,
    "hits" : [
      {
        "_index" : "basketball",
        "_type" : "record",
        "_id" : "1",
        "_score" : 1.0,
        "_source" : {
          "team" : "Chicago Bulls",
          "name" : "Michael Jordan",
          "points" : 30,
          "rebounds" : 3,
          "assists" : 4,
          "submit_date" : "1996-10-11"
        }
      }
    ]
  }
}
```

## 4. âœ” _search : Request body

Request Bodyë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤!

> ê³„ì† ì‚¬ìš©ë˜ëŠ” `-d`ëŠ” directeì˜ ì¤„ì¸ë§

```bash
$ curl -XGET http://localhost:9200/basketball/record/_search?pretty -d '
{
  "query" : {
    "term" : {"points" : 30}
  }  
}' -H 'Content-Type: application/json'
```

`term query`ë¡œ pointsê°€ 30ì¸ ê²ƒë§Œ ì¶œë ¥í–ˆë‹¤.

`points`ê°€ `30`ì¸ í•˜ë‚˜ì˜ ë°ì´í„°ê°€ ë°˜í™˜ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ê²°ê³¼

```bash
{
  "took" : 1,
  "timed_out" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : {
      "value" : 1,
      "relation" : "eq"
    },
    "max_score" : 1.0,
    "hits" : [
      {
        "_index" : "basketball",
        "_type" : "record",
        "_id" : "1",
        "_score" : 1.0,
        "_source" : {
          "team" : "Chicago Bulls",
          "name" : "Michael Jordan",
          "points" : 30,
          "rebounds" : 3,
          "assists" : 4,
          "submit_date" : "1996-10-11"
        }
      }
    ]
  }
}
```

Request Body í™œìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ë§ìœ¼ë‹ˆ [ê³µì‹ ë¬¸ì„œ](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-body.html)ì°¾ì•„ë³´ê³  ê³µë¶€í•´ë³´ì.

---

> ë³¸ í¬ìŠ¤íŒ…ì€ `Inflearn`ì˜ [ELK ìŠ¤íƒ (ElasticSearch, Logstash, Kibana) ìœ¼ë¡œ ë°ì´í„° ë¶„ì„](https://www.inflearn.com/course/elk-%EC%8A%A4%ED%83%9D-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D) ê°•ì˜ë¥¼ ì°¸ê³ í•˜ì—¬ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---
