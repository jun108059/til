# ElasticSearch ë°ì´í„° ì…ë ¥, ì¡°íšŒ, ì‚­ì œ ì‹¤ìŠµ

![img](../.vuepress/public/images/img-es/1.elasticsearchLogo.png)  

---

### ì‹¤ìŠµ í™˜ê²½

- ğŸ’¡ Elasticsearch 7.9.0
- ğŸ’¡ Windows 10
- ğŸ’¡ Git Bash

---

ì‹œì‘í•˜ê¸° ì „ ì§€ë‚œ í¬ìŠ¤íŒ…ì— ì •ë¦¬í•œ í‘œë¥¼ ì°¸ê³ í•˜ê³ ì ì•„ë˜ì— ë„£ì–´ë‘ê² ë‹¤.

`GET`, `POST`, `PUT`, `DELETE` ë¥¼ ë¨¼ì € ì‹¤ìŠµí•´ë³´ê³ ì í•œë‹¤.

---

|ElasticSearch|RDB|
|:---:|:---:|
|**Index**|Database|
|**Type**|Table|
|**Document**|Row|
|**Field**|Column|
|**Mapping**|Schema|

â–² ì €ì¥ êµ¬ì¡°

---

|ElasticSearch|RDB|CRUD|
|:---:|:---:|:---:|
|**GET**|Select|Read|
|**POST**|Insert|Create|
|**PUT**|Update|Update|
|**DELETE**|Delete|Delete|

â–² Query

---

## 1. (Create) Index ë§Œë“¤ê¸°

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ indexê°€ ìƒì„±ëœë‹¤.

```bash
$ curl -XPUT http://localhost:9200/classes?pretty
```

ê²°ê³¼

```bash
{
  "acknowledged" : true,
  "shards_acknowledged" : true,
  "index" : "classes"
}
```

---

## 2. (Read) Index ì¡°íšŒí•˜ê¸°

indexê°€ ì˜ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€ í™•ì¸í•´ë³´ì.

```bash
$ curl -XGET http://localhost:9200/classes?pretty
```

ê²°ê³¼

```bash
{
  "classes" : {
    "aliases" : { },
    "mappings" : { },
    "settings" : {
      "index" : {
        "creation_date" : "1597992858432",
        "number_of_shards" : "1",
        "number_of_replicas" : "1",
        "uuid" : "vPVLv77BSICCXk9VWekU_w",
        "version" : {
          "created" : "7090099"
        },
        "provided_name" : "classes"
      }
    }
  }
}
```

---

## 3. (Delete) Index ì‚­ì œí•˜ê¸°

ì‚­ì œí•´ë³´ì.

```bash
$ curl -XDELETE http://localhost:9200/classes?pretty
```

ê²°ê³¼

```bash
{
  "acknowledged" : true
}
```

ì˜ ì‚­ì œë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ì.

```bash
$ curl -XGET http://localhost:9200/classes?pretty
```

ê²°ê³¼

```bash
{
  "error" : {
    "root_cause" : [
      {
        "type" : "index_not_found_exception",
        "reason" : "no such index [classes]",
        "resource.type" : "index_or_alias",
        "resource.id" : "classes",
        "index_uuid" : "_na_",
        "index" : "classes"
      }
    ],
    "type" : "index_not_found_exception",
    "reason" : "no such index [classes]",
    "resource.type" : "index_or_alias",
    "resource.id" : "classes",
    "index_uuid" : "_na_",
    "index" : "classes"
  },
  "status" : 404
}
```

ì—†ëŠ” indexì— ì ‘ê·¼í•´ 404 ì—ëŸ¬ë¥¼ ë„ìš°ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.


## 4. (Create) Document ë§Œë“¤ê¸°

Tableì˜ Rowì™€ ìœ ì‚¬í•œ ê°œë…ìœ¼ë¡œ `JSON í˜•ì‹`ì˜ ë¬¸ì„œë¼ëŠ” ì°¨ì´ì ì´ ìˆë‹¤.

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

```bash
$ curl -XPOST http://localhost:9200/classes/class/1/ -d '{"title" : "ElasticSearch", "professor" : "Youngjun_Park"}'
```

Window10 í™˜ê²½ì—ì„œ ì‹¤í–‰í•˜ì—¬ `406 Error`ê°€ ì¶œë ¥ëœë‹¤ë©´ ì´ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```bash
$ curl -XPOST http://localhost:9200/classes/class/1/?pretty \
  -H 'Content-Type: application/json' \
  -d '{"title" : "ElasticSearch", "professor" : "Youngjun_Park"}'
```

ê·¸ë˜ë„ ì•ˆëœë‹¤ë©´ ë‚´ê°€ ê²ªì—ˆë˜ ë¬¸ì œì™€ ê°™ì„ ê²ƒ ê°™ìœ¼ë‹ˆ [Error-Handling page](Error-handling.md)ë¥¼ ì°¸ê³ í•˜ë„ë¡ í•˜ì!

ì •ìƒì ìœ¼ë¡œ ìƒì„±ëë‹¤ë©´ ì•„ë˜ì™€ ë¹„ìŠ·í•œ ì¶œë ¥ì„ ë³¼ ìˆ˜ ìˆë‹¤.

```bash
{
  "_index" : "classes",
  "_type" : "class",
  "_id" : "1",
  "_version" : 1,
  "result" : "created",
  "_shards" : {
    "total" : 2,
    "successful" : 1,
    "failed" : 0
  },
  "_seq_no" : 0,
  "_primary_term" : 1
}
```

ì˜ ìƒì„±ëëŠ”ì§€ í™•ì¸í•´ë³´ì.

```bash
$ curl -XGET http://localhost:9200/classes/class/1/?pretty
```

ê²°ê³¼

```bash
{
  "_index" : "classes",
  "_type" : "class",
  "_id" : "1",
  "_version" : 1,
  "_seq_no" : 0,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "ElasticSearch",
    "professor" : "Youngjun_Park"
  }
}
```

## 5. JSON Fileì˜ ë°ì´í„° ì‚½ì…í•˜ê¸°

ë§¤ë²ˆ ë°ì´í„°ë¥¼ ë„£ì„ ë•Œ ë§ˆë‹¤ ìœ„ì™€ ê°™ì´ ì‘ì„±í•  ìˆ˜ëŠ” ì—†ë‹¤.

ì•„ë˜ì— ë³´ì´ëŠ” `JSON` íŒŒì¼ ë°ì´í„°ë¥¼ Insertí•´ë³´ì.

```JSON
{
	"title" : "Algorithm",
	"Professor" : "Youngjun Park",
	"major" : "Computer Science",
	"semester" : ["spring", "fall"],
	"student_count" : 100,
	"unit" : 3,
	"rating" : 5
}
```

`@'fileëª…'` ì„ í¬í•¨í•œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ JSON ë°ì´í„°ë¥¼ ì‚½ì¼í•  ìˆ˜ ìˆë‹¤. 

```bash
curl -XPUT -H 'Content-Type: application/json' http://localhost:9200/classes/class/1/?pretty -d @oneclass.json
```

ê²°ê³¼

```bash
{
  "_index" : "classes",
  "_type" : "class",
  "_id" : "1",
  "_version" : 2,
  "result" : "updated",
  "_shards" : {
    "total" : 2,
    "successful" : 1,
    "failed" : 0
  },
  "_seq_no" : 1,
  "_primary_term" : 1
}
```

ë°ì´í„°ê°€ ì˜ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸í•´ë³´ì.

```bash
curl -GET http://localhost:9200/classes/class/1/?pretty
```

ê²°ê³¼

```bash
{
  "_index" : "classes",
  "_type" : "class",
  "_id" : "1",
  "_version" : 2,
  "_seq_no" : 1,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {
    "title" : "Algorithm",
    "Professor" : "Youngjun Park",
    "major" : "Computer Science",
    "semester" : [
      "spring",
      "fall"
    ],
    "student_count" : 100,
    "unit" : 3,
    "rating" : 5
  }
}
```

---

> ë³¸ í¬ìŠ¤íŒ…ì€ `Inflearn`ì˜ [ELK ìŠ¤íƒ (ElasticSearch, Logstash, Kibana) ìœ¼ë¡œ ë°ì´í„° ë¶„ì„](https://www.inflearn.com/course/elk-%EC%8A%A4%ED%83%9D-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B6%84%EC%84%9D) ê°•ì˜ë¥¼ ì°¸ê³ í•˜ì—¬ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.