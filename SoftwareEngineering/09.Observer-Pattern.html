<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>옵저버 (Observer) 패턴 | Today Youngjun learned✍</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/til/images/logo-144.png">
    <link rel="manifest" href="/til/manifest.json">
    <meta name="description" content="Youngjun`s Personal Wiki (Today I Learned)">
    
    <link rel="preload" href="/til/assets/css/0.styles.5b85764b.css" as="style"><link rel="preload" href="/til/assets/js/app.4da9ca1b.js" as="script"><link rel="preload" href="/til/assets/js/2.f827bc55.js" as="script"><link rel="preload" href="/til/assets/js/120.ba61235a.js" as="script"><link rel="preload" href="/til/assets/js/46.01e6df54.js" as="script"><link rel="prefetch" href="/til/assets/js/10.d7bebace.js"><link rel="prefetch" href="/til/assets/js/100.10add18d.js"><link rel="prefetch" href="/til/assets/js/101.fc5a0940.js"><link rel="prefetch" href="/til/assets/js/102.7a32911f.js"><link rel="prefetch" href="/til/assets/js/103.b87f99b0.js"><link rel="prefetch" href="/til/assets/js/104.568ac1fd.js"><link rel="prefetch" href="/til/assets/js/105.a6266b36.js"><link rel="prefetch" href="/til/assets/js/106.6f9f3240.js"><link rel="prefetch" href="/til/assets/js/107.4b11e714.js"><link rel="prefetch" href="/til/assets/js/108.3b50a929.js"><link rel="prefetch" href="/til/assets/js/109.d62e2365.js"><link rel="prefetch" href="/til/assets/js/11.0f06add5.js"><link rel="prefetch" href="/til/assets/js/110.b5535820.js"><link rel="prefetch" href="/til/assets/js/111.4cb0279a.js"><link rel="prefetch" href="/til/assets/js/112.af713b0f.js"><link rel="prefetch" href="/til/assets/js/113.15fc01bd.js"><link rel="prefetch" href="/til/assets/js/114.27a3c9f9.js"><link rel="prefetch" href="/til/assets/js/115.b29b8bd0.js"><link rel="prefetch" href="/til/assets/js/116.1a75c525.js"><link rel="prefetch" href="/til/assets/js/117.c3985c54.js"><link rel="prefetch" href="/til/assets/js/118.8bbde709.js"><link rel="prefetch" href="/til/assets/js/119.0a6e4091.js"><link rel="prefetch" href="/til/assets/js/12.32cd872d.js"><link rel="prefetch" href="/til/assets/js/121.1d19845e.js"><link rel="prefetch" href="/til/assets/js/122.76352e08.js"><link rel="prefetch" href="/til/assets/js/123.bdf6c8ad.js"><link rel="prefetch" href="/til/assets/js/124.65d6a68f.js"><link rel="prefetch" href="/til/assets/js/125.ba572baa.js"><link rel="prefetch" href="/til/assets/js/126.6362e5f7.js"><link rel="prefetch" href="/til/assets/js/127.278e8d96.js"><link rel="prefetch" href="/til/assets/js/128.940585f8.js"><link rel="prefetch" href="/til/assets/js/129.fcdae323.js"><link rel="prefetch" href="/til/assets/js/13.36b91a88.js"><link rel="prefetch" href="/til/assets/js/130.9ce02b8f.js"><link rel="prefetch" href="/til/assets/js/131.c4f8380d.js"><link rel="prefetch" href="/til/assets/js/132.466b27f2.js"><link rel="prefetch" href="/til/assets/js/133.a74b2bcf.js"><link rel="prefetch" href="/til/assets/js/134.cd262fd3.js"><link rel="prefetch" href="/til/assets/js/135.db0c46d2.js"><link rel="prefetch" href="/til/assets/js/136.8d7c3ae2.js"><link rel="prefetch" href="/til/assets/js/137.095348af.js"><link rel="prefetch" href="/til/assets/js/138.971c20da.js"><link rel="prefetch" href="/til/assets/js/139.b9cae344.js"><link rel="prefetch" href="/til/assets/js/14.59abe798.js"><link rel="prefetch" href="/til/assets/js/140.a9ce3dbf.js"><link rel="prefetch" href="/til/assets/js/141.8021e478.js"><link rel="prefetch" href="/til/assets/js/142.3a7d65a4.js"><link rel="prefetch" href="/til/assets/js/143.2ee38d57.js"><link rel="prefetch" href="/til/assets/js/144.03291af7.js"><link rel="prefetch" href="/til/assets/js/145.b5ab18e9.js"><link rel="prefetch" href="/til/assets/js/146.065a6b7e.js"><link rel="prefetch" href="/til/assets/js/147.d31a5026.js"><link rel="prefetch" href="/til/assets/js/148.5b2a7f31.js"><link rel="prefetch" href="/til/assets/js/149.17fec1d0.js"><link rel="prefetch" href="/til/assets/js/15.dc412a0b.js"><link rel="prefetch" href="/til/assets/js/150.427e1cc8.js"><link rel="prefetch" href="/til/assets/js/151.579a53fa.js"><link rel="prefetch" href="/til/assets/js/152.01535ad9.js"><link rel="prefetch" href="/til/assets/js/153.60074c9b.js"><link rel="prefetch" href="/til/assets/js/154.8e3ca391.js"><link rel="prefetch" href="/til/assets/js/155.b9048e3a.js"><link rel="prefetch" href="/til/assets/js/156.de682c3e.js"><link rel="prefetch" href="/til/assets/js/157.d4677d55.js"><link rel="prefetch" href="/til/assets/js/158.4e1c4361.js"><link rel="prefetch" href="/til/assets/js/159.0f90e010.js"><link rel="prefetch" href="/til/assets/js/16.443cd41c.js"><link rel="prefetch" href="/til/assets/js/160.29f51c86.js"><link rel="prefetch" href="/til/assets/js/17.a5cdb965.js"><link rel="prefetch" href="/til/assets/js/18.0d484a85.js"><link rel="prefetch" href="/til/assets/js/19.1c3892bc.js"><link rel="prefetch" href="/til/assets/js/20.8937f56e.js"><link rel="prefetch" href="/til/assets/js/21.fddd6515.js"><link rel="prefetch" href="/til/assets/js/22.a8d8c325.js"><link rel="prefetch" href="/til/assets/js/23.bce98148.js"><link rel="prefetch" href="/til/assets/js/24.9742c20f.js"><link rel="prefetch" href="/til/assets/js/25.43488937.js"><link rel="prefetch" href="/til/assets/js/26.cfda8508.js"><link rel="prefetch" href="/til/assets/js/27.e5d8505d.js"><link rel="prefetch" href="/til/assets/js/28.c07fc438.js"><link rel="prefetch" href="/til/assets/js/29.9392ca02.js"><link rel="prefetch" href="/til/assets/js/3.c419595a.js"><link rel="prefetch" href="/til/assets/js/30.f00fd4d5.js"><link rel="prefetch" href="/til/assets/js/31.30deb5f6.js"><link rel="prefetch" href="/til/assets/js/32.230901ce.js"><link rel="prefetch" href="/til/assets/js/33.ff775729.js"><link rel="prefetch" href="/til/assets/js/34.14ba38de.js"><link rel="prefetch" href="/til/assets/js/35.58ab0557.js"><link rel="prefetch" href="/til/assets/js/36.48ee3df6.js"><link rel="prefetch" href="/til/assets/js/37.d923853e.js"><link rel="prefetch" href="/til/assets/js/38.d261d060.js"><link rel="prefetch" href="/til/assets/js/39.9837999e.js"><link rel="prefetch" href="/til/assets/js/4.45c650f4.js"><link rel="prefetch" href="/til/assets/js/40.2d9bc2a1.js"><link rel="prefetch" href="/til/assets/js/41.1e89639e.js"><link rel="prefetch" href="/til/assets/js/42.83d0c922.js"><link rel="prefetch" href="/til/assets/js/43.d4b3b5a0.js"><link rel="prefetch" href="/til/assets/js/44.a0dcaecc.js"><link rel="prefetch" href="/til/assets/js/45.a79908d0.js"><link rel="prefetch" href="/til/assets/js/47.1be508f7.js"><link rel="prefetch" href="/til/assets/js/48.2b9b1509.js"><link rel="prefetch" href="/til/assets/js/49.494fbd72.js"><link rel="prefetch" href="/til/assets/js/5.0aa337fe.js"><link rel="prefetch" href="/til/assets/js/50.b3e0241f.js"><link rel="prefetch" href="/til/assets/js/51.497b25e7.js"><link rel="prefetch" href="/til/assets/js/52.079e17c0.js"><link rel="prefetch" href="/til/assets/js/53.eea981ae.js"><link rel="prefetch" href="/til/assets/js/54.27b63246.js"><link rel="prefetch" href="/til/assets/js/55.799a85a9.js"><link rel="prefetch" href="/til/assets/js/56.4d6a321c.js"><link rel="prefetch" href="/til/assets/js/57.bbf8da6b.js"><link rel="prefetch" href="/til/assets/js/58.2ca7da5b.js"><link rel="prefetch" href="/til/assets/js/59.926b192a.js"><link rel="prefetch" href="/til/assets/js/6.52e5f234.js"><link rel="prefetch" href="/til/assets/js/60.221c2169.js"><link rel="prefetch" href="/til/assets/js/61.d1814565.js"><link rel="prefetch" href="/til/assets/js/62.2c62fe16.js"><link rel="prefetch" href="/til/assets/js/63.64d19172.js"><link rel="prefetch" href="/til/assets/js/64.45e22399.js"><link rel="prefetch" href="/til/assets/js/65.4c350e04.js"><link rel="prefetch" href="/til/assets/js/66.5a834cf8.js"><link rel="prefetch" href="/til/assets/js/67.c783ae27.js"><link rel="prefetch" href="/til/assets/js/68.b9bae23d.js"><link rel="prefetch" href="/til/assets/js/69.e0304559.js"><link rel="prefetch" href="/til/assets/js/7.21123317.js"><link rel="prefetch" href="/til/assets/js/70.5dfaa4d5.js"><link rel="prefetch" href="/til/assets/js/71.f96d7948.js"><link rel="prefetch" href="/til/assets/js/72.d3b73ec0.js"><link rel="prefetch" href="/til/assets/js/73.d866814e.js"><link rel="prefetch" href="/til/assets/js/74.df8eb4d1.js"><link rel="prefetch" href="/til/assets/js/75.5d7de152.js"><link rel="prefetch" href="/til/assets/js/76.84d9a412.js"><link rel="prefetch" href="/til/assets/js/77.4e5fdc50.js"><link rel="prefetch" href="/til/assets/js/78.1e1b77d2.js"><link rel="prefetch" href="/til/assets/js/79.9228d008.js"><link rel="prefetch" href="/til/assets/js/8.bc2662d1.js"><link rel="prefetch" href="/til/assets/js/80.9f99425b.js"><link rel="prefetch" href="/til/assets/js/81.edc4bc43.js"><link rel="prefetch" href="/til/assets/js/82.c38528d6.js"><link rel="prefetch" href="/til/assets/js/83.3faadb6e.js"><link rel="prefetch" href="/til/assets/js/84.d8a552da.js"><link rel="prefetch" href="/til/assets/js/85.55f502c3.js"><link rel="prefetch" href="/til/assets/js/86.c493861b.js"><link rel="prefetch" href="/til/assets/js/87.1bb57bd2.js"><link rel="prefetch" href="/til/assets/js/88.2d238be1.js"><link rel="prefetch" href="/til/assets/js/89.25104c46.js"><link rel="prefetch" href="/til/assets/js/9.1d59b63f.js"><link rel="prefetch" href="/til/assets/js/90.5c5e8d16.js"><link rel="prefetch" href="/til/assets/js/91.e169fa49.js"><link rel="prefetch" href="/til/assets/js/92.722f0b66.js"><link rel="prefetch" href="/til/assets/js/93.ad3d53df.js"><link rel="prefetch" href="/til/assets/js/94.000327da.js"><link rel="prefetch" href="/til/assets/js/95.801fd8c3.js"><link rel="prefetch" href="/til/assets/js/96.ca00a28b.js"><link rel="prefetch" href="/til/assets/js/97.71a58138.js"><link rel="prefetch" href="/til/assets/js/98.1a9eea17.js"><link rel="prefetch" href="/til/assets/js/99.bfb3e7b4.js">
    <link rel="stylesheet" href="/til/assets/css/0.styles.5b85764b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/til/" class="home-link router-link-active"><!----> <span class="site-name">Today Youngjun learned✍</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/jun108059/til" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://dev-youngjun.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/jun108059/til" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://dev-youngjun.tistory.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>🎨 Elasticsearch</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/til/ElasticSearch/01.ElasticSearch.html" class="sidebar-link">ElasticSearch Windows10 설치 및 기본 동작 이해</a></li><li><a href="/til/ElasticSearch/02.ElasticSearch.html" class="sidebar-link">ElasticSearch 데이터 입력, 조회, 삭제 실습</a></li><li><a href="/til/ElasticSearch/03.ElasticSearch.html" class="sidebar-link">ElasticSearch 데이터 업데이트 실습</a></li><li><a href="/til/ElasticSearch/04.ElasticSearch.html" class="sidebar-link">ElasticSearch 벌크(Bulk)</a></li><li><a href="/til/ElasticSearch/05.ElasticSearch.html" class="sidebar-link">ElasticSearch 매핑(Mapping)</a></li><li><a href="/til/ElasticSearch/06.ElasticSearch.html" class="sidebar-link">ElasticSearch 데이터 조회(Search)</a></li><li><a href="/til/ElasticSearch/07.ElasticSearch.html" class="sidebar-link">ElasticSearch Metric Aggregation</a></li><li><a href="/til/ElasticSearch/08.ElasticSearch.html" class="sidebar-link">ElasticSearch Bucket Aggregation</a></li><li><a href="/til/ElasticSearch/09.ElasticSearch.html" class="sidebar-link">Elasticsearch7 - Java Rest Client</a></li><li><a href="/til/ElasticSearch/10.ElasticSearch.html" class="sidebar-link">Elasticsearch7 Java REST Client 시작하기</a></li><li><a href="/til/ElasticSearch/14.Logstash.html" class="sidebar-link">Logstash 설치</a></li><li><a href="/til/ElasticSearch/15.Logstash.html" class="sidebar-link">Logstash MySQL 연동하기</a></li><li><a href="/til/ElasticSearch/Error-handling.html" class="sidebar-link">Error Handling Note</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>🐳 Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>🐋 Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>📘 Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>📗 GCP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>📙 Machine Learning</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>📕 Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>💚 Data Structure</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>💝 Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>💙 Kubeflow</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>🖤 News</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>💜 NGINX</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>🤍 Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>🤎 System Programming</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>💛 UX&amp;UI</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>💕 Web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>📌 etc</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="옵저버-observer-패턴"><a href="#옵저버-observer-패턴" class="header-anchor">#</a> 옵저버 (Observer) 패턴</h1> <p>다수의 객체가 특정 객체 상태 변화를 감지하고 알림을 받는 패턴.</p> <p>발행(publish)-구독(subscribe) 패턴을 구현할 수 있다.</p> <p><img src="https://user-images.githubusercontent.com/42997924/153322137-0c49c0f3-ddf2-44db-907b-3fb160dba1c2.png" alt="observer_01"></p> <p><strong>구조</strong></p> <ul><li><p>Subject</p> <ul><li><strong>여러 옵저버를 등록/해지할 수 있는 기능을 제공한다.</strong></li> <li>클라이언트 애플리케이션은 Subject를 사용해서 여러 옵저버들을 특정 Subject에 등록해둔다.</li> <li>Subject가 제공하는 특정한 메소드를 사용해서 Subject 상태를 변경할 수 있다.</li> <li>Subject의 상태가 변경되면 자신에게 등록되어있는 모든 옵저버들을 순회하면서 옵저버가 제공하는 특정한 메소드를 모두 호출해준다.</li></ul></li> <li><p>Observer</p> <ul><li><p>공통된 인터페이스를 제공한다.</p></li> <li><p>인터페이스에서 이벤트가 발생했을 때, 옵저버에서 호출해 줘야하는 메소드가 하나가 필요하다.</p></li> <li><p>이벤트가 담고있는 정보 또는 이벤트 자체를 옵저버에게 전달하면서 특정 메소드를 호출시키고,</p> <p>해당 메소드 내에서 실제로 옵저버가 해야할 일을 하도록 한다.</p></li> <li><p>이 때 일종의 규약을 인터페이스로 만드는 것이다.</p> <p>&quot;어떤 메소드를 어떠한 정보(파라미터, 데이터)를 가지고 호출해라&quot;</p></li></ul></li> <li><p>ConcreteObserver</p> <ul><li>여러 Observer 인터페이스 구현체들</li> <li>실제로 옵저버가 해야할 일을 구현한다.</li></ul></li> <li><p>Observer 인터페이스를 사용하지 않고 구현할 수도 있다. Subject가 Object타입으로 가지고 있으면 된다.</p> <p>하지만, 그렇게되면 어떤 메소드를 호출해야하는지 명확하지 않기 때문에 인터페이스를 제공하는 것이 조금 더 직관적일 수 있다.</p> <p>&quot;옵저버 인터페이스의 메소드 하나를 호출하면 된다.&quot;고 알 수 있기 때문에</p> <ul><li><p>인터페이스를 사용하지 않고, 자바가 제공하는 리플렉션 API를 사용하여 구현할 수도 있다.</p> <p>오브젝트가 가지고 있는 특정 타입정보를 알아낼 수 있고, 타입이 들고 있는 메소드 중에서 특정한 애노테이션을 가지고 있는 대상 메소드를 호출할 수 있다.</p></li></ul></li></ul> <p><img src="https://user-images.githubusercontent.com/42997924/153322139-9c4fa45e-bb3c-4443-9d25-5c998b27bd81.png" alt="observer_02"></p> <h2 id="적용할-수-있는-코드"><a href="#적용할-수-있는-코드" class="header-anchor">#</a> 적용할 수 있는 코드</h2> <ul><li><p>채팅 애플리케이션 예제</p></li> <li><p>사용자들은 특정 주제에 대해 메시지를 보낼 수 있다.</p></li> <li><p>사용자가 특정 주제에 대해 조회하는 순간에 해당 주제에서 나눴던 채팅메시지들을 조회할 수 있다.</p> <p>사용자가 조회하기 전까지는 앞서 다른 사용자가 보낸 메시지가 전달되지 않는다.</p></li> <li><p>사용자들은 특정 주제의 메시지를 받고 싶으면 본인이 직접 getter를 호출해서 주기적으로 메시지를 가져와야한다. ⇒ &quot;폴링(Polling) 메커니즘&quot;</p> <p>주기적으로 가져오는 동작의 리소스가 유용할까?</p> <p>중간에 메시지가 있으면 유용하겠지만 메시지가 변경되지 않으면 불필요한 작업이 계속 발생하게 된다. (리소스 낭비)</p> <p>⇒ 이 애플리케이션의 동작방식에 폴링(Polling) 메커니즘은 적절하지 않다.</p></li> <li><p>옵저버 디자인 패턴을 적용해서 &quot;발행(publish)-구독(subscribe)&quot; 구조로 변경한다.</p></li> <li><p>Client</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChatServer</span> chatServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChatServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">User</span> user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>chatServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        user1<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">&quot;디자인패턴&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;이번엔 옵저버 패턴입니다.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user1<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">&quot;롤드컵2021&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;LCK 화이팅!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">User</span> user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>chatServer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user2<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;디자인패턴&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        user1<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">&quot;디자인패턴&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;예제 코드 보는 중..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user2<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token string">&quot;디자인패턴&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>ChatServer</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatServer</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> messages<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ChatServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>messages<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            messages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> messageList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            messageList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            messages<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> messageList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> messages<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>User</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ChatServer</span> chatServer<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">ChatServer</span> chatServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>chatServer <span class="token operator">=</span> chatServer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        chatServer<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> chatServer<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="옵저버-패턴-적용"><a href="#옵저버-패턴-적용" class="header-anchor">#</a> 옵저버 패턴 적용</h2> <h3 id="_1-옵저버-인터페이스-생성-subscriber"><a href="#_1-옵저버-인터페이스-생성-subscriber" class="header-anchor">#</a> 1. 옵저버 인터페이스 생성 - Subscriber</h3> <ul><li><code>handleMessage()</code> : 메시지를 받을 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Subscriber</span> <span class="token punctuation">{</span>

    <span class="token keyword">void</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-옵저버-구현체-구현-user"><a href="#_2-옵저버-구현체-구현-user" class="header-anchor">#</a> 2. 옵저버 구현체 구현 - User</h3> <ul><li>옵저버 인터페이스 <code>Subscriber</code>를 implements한다.</li> <li><code>handleMessage()</code> 메시지를 오버라이드하여 메시지를 전달받았을 때 수행할 실제 동작을 구현한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Subscriber</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-subject-구현-chatserver"><a href="#_3-subject-구현-chatserver" class="header-anchor">#</a> 3. Subject 구현 - ChatServer</h3> <ul><li><p>각 Subject는 여러 옵저버들을 등록/해지할 수 있는 기능을 제공한다.</p></li> <li><p>옵저버들을 특정한 주제별로 묶어 놓을 것이기 때문에 <code>Map</code>을 사용한다.</p> <ul><li>주제별로 Subscriber들의 목록을 가지고 있게 된다.</li></ul></li> <li><p><code>register()</code></p> <ul><li><p>옵저버를 등록할 수 있는 기능</p></li> <li><p>특정 주제(subject)를 구독할 구독자(Subscriber) 정보를 받아서</p> <p>subscribers에 해당 주제가 있다면 구독자 목록에 추가, 해당 주제가 없다면 새롭게 주제를 만들고 구독자 목록 추가</p></li></ul> <p>※ 코드 작성 시 주의 사항</p> <ul><li><code>List.of()</code>는 ImmutableCollection 을 반환한다. 이렇게 만든 컬렉션에 새로운 인스턴스를 추가할 수 없어서 이후에 추가하려고 하면 에러가
발생한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 올바른 코드</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Subscriber</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>subscriber<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 잘못된 코드 - 위의 코드를 줄이고자 이렇게 작성하면 Immutable 컬렉션이 반환되기 때문에 안 된다.</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>subscriber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><code>unregister()</code></p> <ul><li><p>옵저버를 해지할 수 있는 기능</p></li> <li><p>특정 주제(subject)를 구독하고 있는 구독자(Subscriber) 정보를 받아서</p> <p><code>subscribers</code>에 해당 주제가 있다면 구독자 목록에서 해당 구독자 정보를 삭제한다.</p></li></ul></li> <li><p><code>sendMessage()</code></p> <ul><li>ChatServer(Subject)는 자신(ChatServer, Subject)의 상태를 변경할 수 있는 기능을 제공해야 한다.</li> <li>예제에서는 ChatServer가 데이터를 저장해놓지 않을 것이지만, 사용자가 메시지를 보내는 행위를 상태를 변경하는 행위로 보고 해당 메시지를 여러 Subscriber
들에게 전파시키는 기능을 제공한다.</li> <li>파라미터 정보
<ul><li>User user - 메시지를 보내는 사용자</li> <li>String subject - 주제</li> <li>String message - 보내는 메시지</li></ul></li> <li>전달하려는 메시지  : 메시지를 보낸 사용자 이름 + 메시지 내용</li> <li>전달 대상 : 해당 주제(subject)를 구독하고 있는 구독자</li> <li>구독자 목록을 순회하면서 subscriber가 가지고 있는 <code>handleMessage()</code> 를 호출해서 메시지(<code>userMessage</code>)를 전달한다.</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatServer</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Subscriber</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> subscribers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">Subscriber</span> subscriber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 이미 해당 주제가 있는 경우</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>subscriber<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 새로운 주제인 경우</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Subscriber</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>subscriber<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unregister</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">Subscriber</span> subscriber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>subscriber<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 해당 subject를 구독하고 있는 구독자들을 대상으로</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 전달하려는 메시지</span>
            <span class="token class-name">String</span> userMessage <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">;</span>
            <span class="token comment">// 구독자들에게 메시지 전달</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>subscribers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">handleMessage</span><span class="token punctuation">(</span>userMessage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-client"><a href="#_4-client" class="header-anchor">#</a> 4. Client</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ChatServer</span> chatServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChatServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;keesun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;whiteship&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 특정 주제에 구독자 등록</span>
        chatServer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;오징어게임&quot;</span><span class="token punctuation">,</span> user1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        chatServer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;오징어게임&quot;</span><span class="token punctuation">,</span> user2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        chatServer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;디자인패턴&quot;</span><span class="token punctuation">,</span> user1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 상태 변경 - 메시지 전달</span>
        <span class="token comment">// user1, user2가 메시지를 수신하게 된다.</span>
        chatServer<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>user1<span class="token punctuation">,</span> <span class="token string">&quot;오징어게임&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;아.. 이름이 기억났어.. 일남이야.. 오일남&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// user1만 메시지를 수신하게 된다.</span>
        chatServer<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>user2<span class="token punctuation">,</span> <span class="token string">&quot;디자인패턴&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;옵저버 패턴으로 만든 채팅&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//런타임에 옵저버를 추가하거나 제거할 수 있다.</span>
        chatServer<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token string">&quot;디자인패턴&quot;</span><span class="token punctuation">,</span> user2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        chatServer<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>user2<span class="token punctuation">,</span> <span class="token string">&quot;디자인패턴&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;옵저버 패턴 장, 단점 보는 중&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://user-images.githubusercontent.com/42997924/153322141-e3238e8c-be7a-474e-beb2-10f1b8849022.png" alt="observer_03"></p> <h2 id="장점"><a href="#장점" class="header-anchor">#</a> 장점</h2> <ul><li>상태를 변경하는 객체(publisher)와 변경을 감지하는 객체(subsriber)의 관계를 느슨하게 유지할 수 있다.</li> <li>Subject의 상태 변경을 주기적으로 조회하지 않고 자동으로 감지할 수 있다.</li> <li>런타임에 옵저버를 추가하거나 제거할 수 있다.</li></ul> <h2 id="단점"><a href="#단점" class="header-anchor">#</a> 단점</h2> <ul><li><p>복잡도가 증가한다.</p></li> <li><p>다수의 Observer 객체를 등록 이후 해지 않는다면 memory leak이 발생할 수도 있다.</p> <ul><li><p>예제에서 ChatServer의 subscribers에 등록하고 해지하지 않으면 (아무도 쓰지 않아도 Map에 담겨있다는 이유로) 레퍼런스를 계속해서 가지고 있게 되고,
GC의 대상이 되지 않게된다.</p></li> <li><p>가장 좋은 대안은 명시적으로 해지(unregister)를 잘 하는 것이다. (최우선적인 방법)</p></li> <li><p>자바의 <strong>WeakReference</strong>을 이용할 수도 있다. (명시적으로 해지하기 어려운 경우에 사용)</p> <p>보통 HashMap에 WeakReference를 적용하는 경우가 많다. 다른 곳에서 참조하는 경우가 없으면 unregister를 호출하지 않아도 알아서 해당 레퍼런스를
해지해준다.</p> <p>WeakReference 동작 방식에 따라 참조하지 않는 경우에만 없어지는 것이므로 언제 없어지는지 보장하지 않는다. 따라서 해결책은 아니다.</p></li></ul></li></ul> <h2 id="실무-사용-예"><a href="#실무-사용-예" class="header-anchor">#</a> 실무 사용 예</h2> <ul><li><p>자바</p> <ul><li>Observable과 Observer (자바 9부터 deprecated)</li> <li>자바 9 이후 부터는
<ul><li>PropertyChangeListener, PropertyChangeEvent</li> <li>Flow API</li></ul></li> <li>SAX (Simple API for XML) 라이브러리</li></ul></li> <li><p>스프링</p> <ul><li>ApplicationContext와 ApplicationEvent</li></ul></li></ul> <h3 id="_1-자바-observable과-observer"><a href="#_1-자바-observable과-observer" class="header-anchor">#</a> 1. 자바 - Observable과 Observer</h3> <p>자바에서 옵저버 패턴을 구현하기위해 제공하는 Observer 인터페이스, Observable 클래스 (자바 9부터 deprecated)</p> <ul><li><p><code>setChanged();</code>를 호출하지 않으면 메시지를 받을 수 없다. 상태가 변경되었다고 해야지 알림을 받을 수 있다.</p></li> <li><p>알림을 받는 주체의 순서는 예측할 수 없다.</p></li> <li><p>한 번 변경되었을 때 여러 번 노티해야한다면 <code>notifyObservers(message);</code>를 연속해서 호출한다고 되지 않는다.</p> <p>무조건 <code>setChanged();</code> 한 뒤에 한 번 <code>notifyObservers(message);</code>가 호출된다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token keyword">extends</span> <span class="token class-name">Observable</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 상태가 변경되었다고 알림</span>
    <span class="token function">setChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">notifyObservers</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 호출되지 않음</span>
    <span class="token function">notifyObservers</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    
    <span class="token function">setChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 먼저 setChanged()가 호출된 후에 알림을 보낼 수 있다.</span>
    <span class="token function">notifyObservers</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObserverInJava</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Observable</span> o<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token keyword">extends</span> <span class="token class-name">Observable</span> <span class="token punctuation">{</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 상태가 변경되었다고 알림</span>
            <span class="token function">setChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token function">notifyObservers</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">notifyObservers</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        subject<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        subject<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Java, Observer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>오래된 코드이고 유지보수도 잘 안되고, 사용성이 떨어지는 등... 여러 이유로 Deprecated 된 것 같다.</p> <p><code>java.beans</code> 패키지 내의 <code>PropertyChangeListener</code>  또는 <code>java.util.concurrent</code> 패키지 내의 <code>Flow API</code>를 사용하라고
알려준다.</p> <p><img src="https://user-images.githubusercontent.com/42997924/153322143-3a5f1ae8-9a73-4ada-b1ed-989eb1e35e6e.png" alt="observer_04"></p> <h3 id="_2-자바-propertychangelistener-propertychangeevent"><a href="#_2-자바-propertychangelistener-propertychangeevent" class="header-anchor">#</a> 2. 자바 - PropertyChangeListener, PropertyChangeEvent</h3> <ul><li><p><code>PropertyChangeListener</code>와 <code>PropertyChangeSupport</code> 클래스를 활용</p></li> <li><p>옵저버를 구현하는 방법은 <code>PropertyChangeListener</code> 인터페이스를 구현하면 된다.</p></li> <li><p><code>propertyChange()</code>에서 <code>PropertyChangeEvent</code> 이벤트를 받아서 처리할 수 있다.</p> <ul><li>이벤트에 대해 좀 더 많은 정보를 알 수 있다.</li> <li>getNewValue() : 이벤트에서 값을 꺼내기</li> <li>getPropertyName() : 어떤 프로퍼티가 바뀌었는지 이름을 가져온다.</li> <li>getOldValue() : 변경 전에 어떤 값이었는지 확인</li></ul> <p><img src="https://user-images.githubusercontent.com/42997924/153322144-3dd942f5-49e5-4444-9681-e50b7927f434.png" alt="observer_05"></p></li> <li><p><code>firePropertyChange()</code> : 이벤트 publish</p> <ul><li><p>firePropertyChange(propertyName, oldValue, newValue)</p> <p>PropertyChangeEvent에 들어갈 값을 파라미터로 넣어줘야 한다.</p></li> <li><p>fireIndexedPropertyChange() : 우선순위를 줄 수 있다.</p></li></ul></li> <li><p><code>addPropertyChangeListener()</code> : 옵저버를 등록</p> <ul><li><code>propertyName</code>을 가지고 특정한 관심사에 있는 옵저버만 메시지를 받도록 할 수 있다.</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">PropertyChangeEvent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">PropertyChangeListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">PropertyChangeSupport</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PropertyChangeExample</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">PropertyChangeListener</span> <span class="token punctuation">{</span>

        <span class="token comment">// 이벤트 받아서 처리</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">propertyChange</span><span class="token punctuation">(</span><span class="token class-name">PropertyChangeEvent</span> evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 이벤트에 대한 다양한 정보를 확인할 수 있다.</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span><span class="token function">getNewValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span>

        <span class="token class-name">PropertyChangeSupport</span> support <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PropertyChangeSupport</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 옵저버 등록</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token class-name">PropertyChangeListener</span> observer<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            support<span class="token punctuation">.</span><span class="token function">addPropertyChangeListener</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 옵저버 해제</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeObserver</span><span class="token punctuation">(</span><span class="token class-name">PropertyChangeListener</span> observer<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            support<span class="token punctuation">.</span><span class="token function">removePropertyChangeListener</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 이벤트 publish</span>
            support<span class="token punctuation">.</span><span class="token function">firePropertyChange</span><span class="token punctuation">(</span><span class="token string">&quot;eventName&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        subject<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        subject<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;자바 PCL 예제 코드&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        subject<span class="token punctuation">.</span><span class="token function">removeObserver</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        subject<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;이 메시지는 볼 수 없지..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-자바-flow-api"><a href="#_3-자바-flow-api" class="header-anchor">#</a> 3. 자바 - Flow API</h3> <p>자바 9에 처음 도입된 API</p> <p>리액티브 스트림을 구현할 수 있도록 자바에서 제공해주는 인터페이스 목록</p> <ul><li>Publisher</li> <li>Subscriber</li> <li>Subscription</li> <li>Processor : Subscriber와 Publisher 일을 둘 다 수행하는 인터페이스</li></ul> <h4 id="가장-기초적인-동기-방식의-pub-sub-구조-예제"><a href="#가장-기초적인-동기-방식의-pub-sub-구조-예제" class="header-anchor">#</a> 가장 기초적인 동기 방식의 pub-sub 구조 예제</h4> <p>Publisher</p> <ul><li><p>Publisher에서 subscribe하면 subscriber.onNext()를 호출해서 메시지를 전달한다.</p></li> <li><p>onComplete() 호출해서 완료</p></li></ul> <p>Subscriber</p> <ul><li>onNext()로 메시지를 전달받는다.</li> <li>onComplete()이 호출되었으므로 onComplete()에 구현한 동작 수행 후 종료</li></ul> <h4 id="비동기-방식의-pub-sub-구조-예제-submissionpublisher"><a href="#비동기-방식의-pub-sub-구조-예제-submissionpublisher" class="header-anchor">#</a> 비동기 방식의 pub-sub 구조 예제 - SubmissionPublisher</h4> <p>비동기적으로 이벤트를 처리하게 할 수 있도록 자바에서 기능을 제공해준다. → &quot;<strong>SubmissionPublisher</strong>&quot;</p> <p>비동기적으로 Flow API를 사용할 수 있도록 기능을 제공해주는 publisher이다.</p> <p><code>onSubscribe()</code>가 호출되면 <code>Subscription</code>을 저장해두고, 바로 요청을 처리해야되기 때문에 <code>subscription.request(n)</code>를 호출해서
publisher에게 n개 이벤트를 요청해서 꺼내오게 된다.</p> <p>publisher가 n개를 꺼내서 알아서 <code>onNext()</code>를 호출해준다.</p> <ul><li>onNext() 스레드는 <code>SubmissionPublisher</code> 가 만들어주는 스레드풀에서 하나의 스레드를 사용하게 된다.</li></ul> <p>리액티브 스트림 API의 주요 목적 중 하나는 비동기 처리 뿐만 아니라 비동기 처리하면서 백프레셔를 관리하는 것이다. 흐름양을 조절한다. 구독하는 쪽에서 처리하면서 n개씩 달라고
하면서 배압을 조절할 수 있다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Flow</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">SubmissionPublisher</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowInJava</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Flow<span class="token punctuation">.</span>Publisher</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> publisher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubmissionPublisher</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Flow<span class="token punctuation">.</span>Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> subscriber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Flow<span class="token punctuation">.</span>Subscriber</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">private</span> <span class="token class-name">Flow<span class="token punctuation">.</span>Subscription</span> subscription<span class="token punctuation">;</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSubscribe</span><span class="token punctuation">(</span><span class="token class-name">Flow<span class="token punctuation">.</span>Subscription</span> subscription<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;sub!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 저장</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>subscription <span class="token operator">=</span> subscription<span class="token punctuation">;</span>
                <span class="token comment">// publisher에게 1개 요청</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>subscription<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNext</span><span class="token punctuation">(</span><span class="token class-name">String</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;onNext called&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 비동기로 처리되는지 확인하기 위해 스레드명 출력</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;completed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 구독</span>
        publisher<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>subscriber<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">SubmissionPublisher</span><span class="token punctuation">)</span> publisher<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token string">&quot;hello java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;이게 먼저 출력될 수도 있습니다.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://user-images.githubusercontent.com/42997924/153322145-aa581c01-e0b0-4d04-94a5-dcce9770c5f5.png" alt="observer_06"></p> <h3 id="_4-스프링-applicationcontext와-applicationevent"><a href="#_4-스프링-applicationcontext와-applicationevent" class="header-anchor">#</a> 4. 스프링 - ApplicationContext와 ApplicationEvent</h3> <p>ApplicationContext - 스프링 IoC의 대표 Container</p> <p>ApplicationContext가 이벤트 Publisher이다.</p> <h5 id="_1-이벤트-클래스-구현"><a href="#_1-이벤트-클래스-구현" class="header-anchor">#</a> 1. 이벤트 클래스 구현</h5> <ul><li>이벤트를 통해 전달하고 싶은 데이터를 필드로 추가하면 된다.
<ul><li>전달하려는 데이터는 생성자로 받아오면 된다.</li></ul></li> <li>굳이 스프링이 제공해주는 <code>ApplicationEvent</code>  타입을 쓰지 않고 임의의 타입도 이벤트로 전달할 수 있다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyEvent</span> <span class="token punctuation">{</span>
    <span class="token comment">// 전달하려는 데이터</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span> 

    <span class="token keyword">public</span> <span class="token class-name">MyEvent</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>ApplicationEvent 클래스를 상속받아서 구현할 수 있다.</p></li> <li><p>source : 이벤트를 제공하는 publisher 정보를 지칭</p></li></ul> <h5 id="_2-이벤트-발생"><a href="#_2-이벤트-발생" class="header-anchor">#</a> 2. 이벤트 발생</h5> <p>여러 방법이 있지만 ApplicationRunner을 이용</p> <p>※ ApplicationRunner</p> <ul><li>스프링 부트가 제공하는 기능</li> <li>스프링 부트가 애플리케이션을 띄웠을 때 자동으로 실행해주는 코드를 넣고 싶으면 ApplicationRunner을 구현하면 된다.</li></ul> <p>ApplicationContext를 이용해서 이벤트를 publish할 수 있다. 구체적으로는 ApplicationContext가 구현하고 있는
ApplicationEventPublisher를 사용해도 된다.</p> <ul><li><code>publishEvent(이벤트)</code> : 이벤트를 만들어서 publish</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRunner</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationRunner</span> <span class="token punctuation">{</span>
    <span class="token comment">// 가장 구체적인 인터페이스 타입</span>
    <span class="token keyword">private</span> <span class="token class-name">ApplicationEventPublisher</span> publisher<span class="token punctuation">;</span> 

    <span class="token keyword">public</span> <span class="token class-name">MyRunner</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEventPublisher</span> publisher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>publisher <span class="token operator">=</span> publisher<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 이벤트를 만들어서 publish</span>
        publisher<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyEvent</span><span class="token punctuation">(</span><span class="token string">&quot;hello spring event&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_3-이벤트-리스너-구현"><a href="#_3-이벤트-리스너-구현" class="header-anchor">#</a> 3. 이벤트 리스너 구현</h5> <ul><li>ApplicationListener를 구현하지 않아도 된다.</li> <li><code>@EventListener(MyEvent.class)</code> 애노테이션을 활용해서 리스닝하려는 이벤트 클래스를 선언해주면 된다.</li> <li>이벤트 클래스 타입 그대로 파라미터로 전달받으면 된다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyEventListener</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@EventListener</span><span class="token punctuation">(</span><span class="token class-name">MyEvent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">MyEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>ApplicationListener를 구현해서 만들 수 있다.</p></li> <li><p>제네릭 타입으로 전달받고자 하는 이벤트 타입을 적어준다.</p></li> <li><p>빈으로 등록이 되어있어야 스프링이 알아서 연결해주므로 <code>@Component</code> 애노테이션을 붙여서 빈으로 등록한다.</p></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/10/2022, 8:37:32 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/til/assets/js/app.4da9ca1b.js" defer></script><script src="/til/assets/js/2.f827bc55.js" defer></script><script src="/til/assets/js/120.ba61235a.js" defer></script><script src="/til/assets/js/46.01e6df54.js" defer></script>
  </body>
</html>
